{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///D:/projects/browser/node_modules/has-flag/index.js","webpack:///D:/projects/browser/node_modules/supports-color/index.js","webpack:///./node_modules/.store/debug@4.3.4/node_modules/debug/src/browser.js","webpack:///./node_modules/.store/debug@4.3.4/node_modules/debug/src/common.js","webpack:///./node_modules/.store/debug@4.3.4/node_modules/debug/src/index.js","webpack:///./node_modules/.store/debug@4.3.4/node_modules/debug/src/node.js","webpack:///./node_modules/.store/ms@2.1.2/node_modules/ms/index.js","webpack:///./src/browser/api/browser-action.ts","webpack:///./src/browser/api/commands.ts","webpack:///./src/browser/api/common.ts","webpack:///./src/browser/api/context-menus.ts","webpack:///./src/browser/api/cookies.ts","webpack:///./src/browser/api/i18n.ts","webpack:///./src/browser/api/notifications.ts","webpack:///./src/browser/api/permissions.ts","webpack:///./src/browser/api/runtime.ts","webpack:///./src/browser/api/tabs.ts","webpack:///./src/browser/api/web-navigation.ts","webpack:///./src/browser/api/windows.ts","webpack:///./src/browser/index.ts","webpack:///./src/browser/popup.ts","webpack:///./src/browser/router.ts","webpack:///./src/browser/store.ts","webpack:///./src/index.ts","webpack:///external \"electron\"","webpack:///external \"events\"","webpack:///external \"fs\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///external \"tty\"","webpack:///external \"util\""],"names":["debug","require","app","isReady","protocol","registerSchemesAsPrivileged","scheme","privileges","bypassCSP","getBrowserActionDefaults","extension","manifest","getExtensionManifest","browser_action","action","title","default_title","name","iconPath","getIconPath","icon","path","default_popup","popup","BrowserActionAPI","constructor","ctx","actionMap","Map","observers","Set","queuedUpdate","handleCrxRequest","request","callback","url","response","URL","hostname","requestType","tabId","searchParams","get","fragments","pathname","split","extensionId","imageSize","parseInt","resizeType","ResizeType","Up","session","getExtension","iconDetails","tabs","iconImage","iconAbsPath","resolveExtensionPath","nativeImage","createFromPath","imagePath","matchSize","replace","imageData","createFromDataURL","undefined","statusCode","mimeType","data","toPNG","e","console","error","handle","router","apiHandler","getter","propName","details","getAction","id","result","setDetails","value","defaults","valueObj","tabAction","Object","assign","onUpdate","setter","event","handleProp","prop","key","iconModified","Date","now","preloadOpts","allowRemote","extensionContext","getState","bind","activate","sender","webContents","add","once","delete","store","on","actionDetails","setupSession","processExtension","removeActions","registerBufferProtocol","setupProtocol","set","has","getPopupUrl","popupPath","defaultAction","actions","Array","from","entries","map","rest","tabsInfo","keys","activeTab","getActiveTabOfCurrentWindow","activeTabId","eventType","activateClick","activateContextMenu","anchorRect","toggleExtension","isDestroyed","destroy","tab","getTabById","Error","popupUrl","win","tabToWindow","PopupView","parent","emit","tabDetails","tabDetailsCache","sendEvent","menu","Menu","append","opts","MenuItem","appendSeparator","type","label","click","homePageUrl","homepage_url","createTab","contextMenuItems","buildMenuItems","length","forEach","item","optionsPage","options_page","options_ui","page","optionsPageUrl","getExtensionUrl","enabled","x","Math","floor","y","height","queueMicrotask","size","observer","send","CommandsAPI","getAll","uri","href","resPath","startsWith","validateExtensionResource","fs","stat","imageSet","match","first","pop","iconSize","icons","default_icon","getIconImage","iconAbsolutePath","escapePattern","pattern","matchesPattern","regexp","RegExp","join","DEFAULT_CONTEXTS","getContextTypesFromParams","params","contexts","mediaType","pageURL","linkURL","frameURL","selectionText","isEditable","formatTitle","includes","matchesConditions","props","conditions","visible","contextTypes","targetUrl","documentUrl","inContext","some","context","targetUrlPatterns","documentUrlPatterns","ContextMenusAPI","menus","buildMenuItem","showIcon","resize","width","menuItemOptions","onClicked","buildMenuItemsFromTemplate","menuItemTemplates","itemMap","menuItem","parentId","parentMenuItem","submenu","push","menuItems","buildFromTemplate","isArray","create","createProperties","addContextItem","remove","menuItemId","items","removeAll","buildMenuItemsForExtension","contextItems","buildMenuItemsForParams","srcURL","propItems","menuType","extensionItems","checked","frameId","frameUrl","editable","wasChecked","pageUrl","linkUrl","parentMenuItemId","srcUrl","CookieStoreID","onChangedCauseTranslation","createCookieDetails","cookie","domain","hostOnly","Boolean","httpOnly","secure","storeId","Default","CookiesAPI","cookies","onChanged","cause","removed","changeInfo","broadcastEvent","getAllCookieStores","addListener","tabIds","filter","eval","I18nAPI","getAllMessage","localeName","getLocale","localePath","existsSync","message","file","localeJson","con","readFileSync","JSON","parse","trim","warn","TemplateType","getBody","Basic","List","getUrgency","priority","createScopedIdentifier","stripScopeFromIdentifier","index","indexOf","substr","NotificationsAPI","registry","clear","notificationId","close","arg1","arg2","iconUrl","notification","Notification","subtitle","body","silent","urgency","timeoutType","requireInteraction","byUser","show","getPermissionLevel","isSupported","update","PermissionsAPI","contains","permissions","RuntimeAPI","EventEmitter","openOptionsPage","active","TabsAPI","getAllInWindow","getSelected","getCurrent","insertCSS","query","reload","goForward","goBack","observeTab","updateEvents","updateHandler","onUpdated","eventName","faviconHandler","favicons","favicon","off","removeTab","onRemoved","onCreated","onActivated","getType","getURL","createTabDetails","getActiveTabFromWebContents","getSize","audible","isCurrentlyAudible","autoDiscardable","discarded","favIconUrl","highlighted","incognito","mutedInfo","muted","audioMuted","pinned","selected","status","isLoading","getTitle","windowId","impl","assignTabDetails","getTabDetails","TAB_ID_NONE","WINDOW_ID_CURRENT","lastFocusedWindowId","browserWindow","code","info","isSet","filteredTabs","reloadProperties","bypassCache","reloadIgnoringCache","updateProperties","loadURL","setAudioMuted","ids","prevDetails","compareProps","didUpdate","WindowsAPI","WINDOW_ID_NONE","BrowserWindow","getAllWindows","find","isWindowClosing","activeChanged","setActiveTab","tabInfo","cacheTabId","getFrame","frameProcessId","frameRoutingId","electron","fromId","getFrameId","frame","top","frameTreeNodeId","getParentFrameId","parentFrame","getFrameDetails","errorOccurred","processId","parentFrameId","WebNavigationAPI","sendNavigationEvent","onCreatedNavigationTarget","isInPlace","isMainFrame","sourceTabId","sourceProcessId","sourceFrameId","timeStamp","onBeforeNavigate","onCommitted","httpResponseCode","httpStatusText","onHistoryStateUpdated","transitionType","transitionQualifiers","onDOMContentLoaded","isLoadingMainFrame","onFinishLoad","getAllFrames","mainFrame","targetFrame","framesInSubtree","getWindowState","isMaximized","isMinimized","isFullScreen","getLastFocused","observeWindow","window","onFocusChanged","windowDetailsCache","removeWindow","createWindowDetails","focused","isFocused","getPosition","left","ownerWindow","isPersistent","state","alwaysOnTop","isAlwaysOnTop","sessionId","getWindowDetails","getWindowFromId","getCurrentWindow","getWindowById","getLastFocusedWindow","windows","createWindow","maximize","minimize","restore","removedWindowId","windowDetails","sessionMap","WeakMap","ElectronChromeExtensions","fromSession","modulePath","api","electronSession","defaultSession","ExtensionRouter","ExtensionStore","__dirname","browserAction","contextMenus","commands","i18n","notifications","runtime","webNavigation","prependPreload","preloads","getPreloads","preloadPath","preloadIndex","splice","setPreloads","preloadExists","isFile","addTab","selectTab","addExtensionHost","host","getContextMenuItems","addExtension","removeExtension","Extensions","destroyed","usingPreferredSize","readyPromise","isDevToolsOpened","closeDevTools","maybeClose","getFocusedWindow","updatePreferredSize","setSize","updatePosition","movable","maximizable","minimizable","resizable","skipTaskbar","backgroundColor","webPreferences","sandbox","nodeIntegration","nodeIntegrationInWorker","nativeWindowOpen","worldSafeExecuteJavaScript","contextIsolation","enablePreferredSizeMode","untypedWebContents","load","BOUNDS","maxWidth","maxHeight","Promise","resolve","setTimeout","queryPreferredSize","whenReady","rect","min","max","minWidth","minHeight","setBounds","getBounds","winBounds","viewBounds","POSITION_PADDING","executeJavaScript","document","getBoundingClientRect","createDebug","shortenValues","k","v","formatters","r","stringify","DEFAULT_SESSION","gRoutingDelegate","RoutingDelegate","onRouterMessage","handlerName","args","onExtensionMessage","onRemoteMessage","sessionPartition","ses","fromPartition","onAddListener","listener","onRemoveListener","removeListener","ipcMain","addObserver","eventListenerEquals","eventListener","other","delegate","handlers","listeners","extensionHosts","filterListeners","predicate","filteredListeners","delta","observeListenerHost","eventListeners","existingEventListener","findIndex","getHandler","handler","extEvent","el","ipcName","windowToActiveTab","addWindow","windowHasTabs","getActiveTabFromWindow","wc","fromWebContents","prevActiveTab"],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPa;AACb,WAAW,mBAAO,CAAC,cAAI;AACvB,gBAAgB,mBAAO,CAAC,sDAAU;;AAElC,OAAO,IAAI;;AAEX;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iCAAiC,GAAG;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzIA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;;AAEvD;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oFAAU;;AAEnC,OAAO,WAAW;;AAElB;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mBAAO,CAAC,mEAAI;AACpC;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,YAAY,cAAc;AAC1B;AACA;AACA;AACA;;AAEA,iBAAiB,sBAAsB;AACvC;AACA,aAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAsC;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAI;AACJ;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;;AAEA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,MAAM;AACjB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACjRA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB,mBAAO,CAAC,yFAAc;AACxC,CAAC;AACD,kBAAkB,mBAAO,CAAC,mFAAW;AACrC;;;;;;;;;;;;ACTA;AACA;AACA;;AAEA,YAAY,mBAAO,CAAC,gBAAK;AACzB,aAAa,mBAAO,CAAC,kBAAM;;AAE3B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,uBAAuB,mBAAO,CAAC,kEAAgB;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,4DAA4D;AAC5D;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,CAAC,IAAI;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,2BAA2B;;AAEnC;AACA;AACA,iDAAiD,EAAE;AACnD,sBAAsB,WAAW,IAAI,KAAK;;AAE1C;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oFAAU;;AAEnC,OAAO,WAAW;;AAElB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtQA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,cAAc;AACzB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","'use strict';\nmodule.exports = (flag, argv) => {\n\targv = argv || process.argv;\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst pos = argv.indexOf(prefix + flag);\n\tconst terminatorPos = argv.indexOf('--');\n\treturn pos !== -1 && (terminatorPos === -1 ? true : pos < terminatorPos);\n};\n","'use strict';\nconst os = require('os');\nconst hasFlag = require('has-flag');\n\nconst {env} = process;\n\nlet forceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false') ||\n\thasFlag('color=never')) {\n\tforceColor = 0;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tforceColor = 1;\n}\nif ('FORCE_COLOR' in env) {\n\tif (env.FORCE_COLOR === true || env.FORCE_COLOR === 'true') {\n\t\tforceColor = 1;\n\t} else if (env.FORCE_COLOR === false || env.FORCE_COLOR === 'false') {\n\t\tforceColor = 0;\n\t} else {\n\t\tforceColor = env.FORCE_COLOR.length === 0 ? 1 : Math.min(parseInt(env.FORCE_COLOR, 10), 3);\n\t}\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(stream) {\n\tif (forceColor === 0) {\n\t\treturn 0;\n\t}\n\n\tif (hasFlag('color=16m') ||\n\t\thasFlag('color=full') ||\n\t\thasFlag('color=truecolor')) {\n\t\treturn 3;\n\t}\n\n\tif (hasFlag('color=256')) {\n\t\treturn 2;\n\t}\n\n\tif (stream && !stream.isTTY && forceColor === undefined) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor || 0;\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\tif (process.platform === 'win32') {\n\t\t// Node.js 7.5.0 is the first version of Node.js to include a patch to\n\t\t// libuv that enables 256 color output on Windows. Anything earlier and it\n\t\t// won't work. However, here we target Node.js 8 at minimum as it is an LTS\n\t\t// release, and Node.js 7 is not. Windows 10 build 10586 is the first Windows\n\t\t// release that supports 256 colors. Windows 10 build 14931 is the first release\n\t\t// that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(process.versions.node.split('.')[0]) >= 8 &&\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream) {\n\tconst level = supportsColor(stream);\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel(process.stdout),\n\tstderr: getSupportLevel(process.stderr)\n};\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","import { Menu, MenuItem, protocol, nativeImage, app } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { PopupView } from '../popup'\r\nimport { ExtensionEvent } from '../router'\r\nimport {\r\n  getExtensionUrl,\r\n  getExtensionManifest,\r\n  getIconPath,\r\n  resolveExtensionPath,\r\n  matchSize,\r\n  ResizeType,\r\n} from './common'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:browserAction')\r\n\r\nif (!app.isReady()) {\r\n  protocol.registerSchemesAsPrivileged([{ scheme: 'crx', privileges: { bypassCSP: true } }])\r\n}\r\n\r\ninterface ExtensionAction {\r\n  color?: string\r\n  text?: string\r\n  title?: string\r\n  icon?: chrome.browserAction.TabIconDetails\r\n  popup?: string\r\n  /** Last modified date for icon. */\r\n  iconModified?: number\r\n}\r\n\r\ntype ExtensionActionKey = keyof ExtensionAction\r\n\r\ninterface ActivateDetails {\r\n  eventType: string\r\n  extensionId: string\r\n  tabId: number\r\n  anchorRect: { x: number; y: number; width: number; height: number }\r\n}\r\n\r\nconst getBrowserActionDefaults = (extension: Electron.Extension): ExtensionAction | undefined => {\r\n  const manifest = getExtensionManifest(extension)\r\n  const { browser_action } = manifest\r\n  if (typeof browser_action === 'object') {\r\n    const action: ExtensionAction = {}\r\n\r\n    action.title = browser_action.default_title || manifest.name\r\n\r\n    const iconPath = getIconPath(extension)\r\n    if (iconPath) action.icon = { path: iconPath }\r\n\r\n    if (browser_action.default_popup) {\r\n      action.popup = browser_action.default_popup\r\n    }\r\n\r\n    return action\r\n  }\r\n}\r\n\r\ninterface ExtensionActionStore extends Partial<ExtensionAction> {\r\n  tabs: { [key: string]: ExtensionAction }\r\n}\r\n\r\nexport class BrowserActionAPI {\r\n  private actionMap = new Map</* extensionId */ string, ExtensionActionStore>()\r\n  private popup?: PopupView\r\n\r\n  private observers: Set<Electron.WebContents> = new Set()\r\n  private queuedUpdate: boolean = false\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n\r\n    const getter =\r\n      (propName: ExtensionActionKey) =>\r\n      ({ extension }: ExtensionEvent, details: chrome.browserAction.TabDetails = {}) => {\r\n        const { tabId } = details\r\n        const action = this.getAction(extension.id)\r\n\r\n        let result\r\n\r\n        if (tabId) {\r\n          if (action.tabs[tabId]) {\r\n            result = action.tabs[tabId][propName]\r\n          } else {\r\n            result = action[propName]\r\n          }\r\n        } else {\r\n          result = action[propName]\r\n        }\r\n\r\n        return result\r\n      }\r\n\r\n    const setDetails = (\r\n      { extension }: ExtensionEvent,\r\n      details: any,\r\n      propName: ExtensionActionKey\r\n    ) => {\r\n      const { tabId } = details\r\n      let value = (details as any)[propName] || undefined\r\n\r\n      if (typeof value === 'undefined') {\r\n        const defaults = getBrowserActionDefaults(extension)\r\n        value = defaults ? defaults[propName] : value\r\n      }\r\n\r\n      const valueObj = { [propName]: value }\r\n      const action = this.getAction(extension.id)\r\n\r\n      if (tabId) {\r\n        const tabAction = action.tabs[tabId] || (action.tabs[tabId] = {})\r\n        Object.assign(tabAction, valueObj)\r\n      } else {\r\n        Object.assign(action, valueObj)\r\n      }\r\n\r\n      this.onUpdate()\r\n    }\r\n\r\n    const setter =\r\n      (propName: ExtensionActionKey) =>\r\n      (event: ExtensionEvent, details: chrome.browserAction.TabDetails) =>\r\n        setDetails(event, details, propName)\r\n\r\n    const handleProp = (prop: string, key: ExtensionActionKey) => {\r\n      handle(`browserAction.get${prop}`, getter(key))\r\n      handle(`browserAction.set${prop}`, setter(key))\r\n    }\r\n\r\n    handleProp('BadgeBackgroundColor', 'color')\r\n    handleProp('BadgeText', 'text')\r\n    handleProp('Title', 'title')\r\n    handleProp('Popup', 'popup')\r\n\r\n    // setIcon is unique in that it can pass in a variety of properties. Here we normalize them\r\n    // to use 'icon'.\r\n    handle(\r\n      'browserAction.setIcon',\r\n      (event, { tabId, ...details }: chrome.browserAction.TabIconDetails) => {\r\n        setDetails(event, { tabId, icon: details }, 'icon')\r\n        setDetails(event, { tabId, iconModified: Date.now() }, 'iconModified')\r\n      }\r\n    )\r\n\r\n    // browserAction preload API\r\n    const preloadOpts = { allowRemote: true, extensionContext: false }\r\n    handle('browserAction.getState', this.getState.bind(this), preloadOpts)\r\n    handle('browserAction.activate', this.activate.bind(this), preloadOpts)\r\n    handle(\r\n      'browserAction.addObserver',\r\n      (event) => {\r\n        const { sender: webContents } = event\r\n        this.observers.add(webContents)\r\n        webContents.once('destroyed', () => {\r\n          this.observers.delete(webContents)\r\n        })\r\n      },\r\n      preloadOpts\r\n    )\r\n    handle(\r\n      'browserAction.removeObserver',\r\n      (event) => {\r\n        const { sender: webContents } = event\r\n        this.observers.delete(webContents)\r\n      },\r\n      preloadOpts\r\n    )\r\n\r\n    this.ctx.store.on('active-tab-changed', () => {\r\n      this.onUpdate()\r\n    })\r\n\r\n    // Clear out tab details when removed\r\n    this.ctx.store.on('tab-removed', (tabId: number) => {\r\n      for (const [, actionDetails] of this.actionMap) {\r\n        if (actionDetails.tabs[tabId]) {\r\n          delete actionDetails.tabs[tabId]\r\n        }\r\n      }\r\n      this.onUpdate()\r\n    })\r\n\r\n    this.setupSession(this.ctx.session)\r\n  }\r\n\r\n  private setupSession(session: Electron.Session) {\r\n    session.on('extension-loaded', (event, extension) => {\r\n      this.processExtension(extension)\r\n    })\r\n\r\n    session.on('extension-unloaded', (event, extension) => {\r\n      this.removeActions(extension.id)\r\n    })\r\n\r\n    session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\r\n  }\r\n\r\n  public setupProtocol(session:Electron.Session){\r\n    const result=session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\r\n    return result\r\n  }\r\n\r\n  private handleCrxRequest = (\r\n    request: Electron.ProtocolRequest,\r\n    callback: (response: Electron.ProtocolResponse) => void\r\n  ) => {\r\n    debug('%s', request.url)\r\n\r\n    let response: Electron.ProtocolResponse\r\n\r\n    try {\r\n      const url = new URL(request.url)\r\n      const { hostname: requestType } = url\r\n\r\n      switch (requestType) {\r\n        case 'extension-icon': {\r\n          const tabId = url.searchParams.get('tabId')\r\n\r\n          const fragments = url.pathname.split('/')\r\n          const extensionId = fragments[1]\r\n          const imageSize = parseInt(fragments[2], 10)\r\n          const resizeType = parseInt(fragments[3], 10) || ResizeType.Up\r\n\r\n          const extension = this.ctx.session.getExtension(extensionId)\r\n\r\n          let iconDetails: chrome.browserAction.TabIconDetails | undefined\r\n\r\n          const action = this.actionMap.get(extensionId)\r\n          if (action) {\r\n            iconDetails = (tabId && action.tabs[tabId]?.icon) || action.icon\r\n          }\r\n\r\n          let iconImage\r\n          if (extension && iconDetails) {\r\n            if (typeof iconDetails.path === 'string') {\r\n              const iconAbsPath = resolveExtensionPath(extension, iconDetails.path)\r\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\r\n            } else if (typeof iconDetails.path === 'object') {\r\n              const imagePath = matchSize(iconDetails.path, imageSize, resizeType)\r\n              let iconAbsPath = imagePath && resolveExtensionPath(extension, imagePath)\r\n              iconAbsPath=iconAbsPath?.replace('/chrome-extension:/'+extensionId,'') // \r\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\r\n            } else if (typeof iconDetails.imageData === 'string') {\r\n              iconImage = nativeImage.createFromDataURL(iconDetails.imageData)\r\n            } else if (typeof iconDetails.imageData === 'object') {\r\n              const imageData = matchSize(iconDetails.imageData as any, imageSize, resizeType)\r\n              iconImage = imageData ? nativeImage.createFromDataURL(imageData) : undefined\r\n            }\r\n          }\r\n\r\n          if (iconImage) {\r\n            response = {\r\n              statusCode: 200,\r\n              mimeType: 'image/png',\r\n              data: iconImage.toPNG(),\r\n            }\r\n          } else {\r\n            response = { statusCode: 400 }\r\n          }\r\n\r\n          break\r\n        }\r\n        default: {\r\n          response = { statusCode: 400 }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(e)\r\n\r\n      response = {\r\n        statusCode: 500,\r\n      }\r\n    }\r\n\r\n    callback(response)\r\n  }\r\n\r\n  private getAction(extensionId: string) {\r\n    let action = this.actionMap.get(extensionId)\r\n    if (!action) {\r\n      action = { tabs: {} }\r\n      this.actionMap.set(extensionId, action)\r\n      this.onUpdate()\r\n    }\r\n\r\n    return action\r\n  }\r\n\r\n  // TODO: Make private for v4 major release.\r\n  removeActions(extensionId: string) {\r\n    if (this.actionMap.has(extensionId)) {\r\n      this.actionMap.delete(extensionId)\r\n    }\r\n\r\n    this.onUpdate()\r\n  }\r\n\r\n  private getPopupUrl(extensionId: string, tabId: number) {\r\n    const action = this.getAction(extensionId)\r\n    const popupPath = action.tabs[tabId]?.popup || action.popup || undefined\r\n    return popupPath && `chrome-extension://${extensionId}/${popupPath}`\r\n  }\r\n\r\n  // TODO: Make private for v4 major release.\r\n  processExtension(extension: Electron.Extension) {\r\n    const defaultAction = getBrowserActionDefaults(extension)\r\n    if (defaultAction) {\r\n      const action = this.getAction(extension.id)\r\n      Object.assign(action, defaultAction)\r\n    }\r\n  }\r\n\r\n  private getState() {\r\n    // Get state without icon data.\r\n    const actions = Array.from(this.actionMap.entries()).map(([id, details]) => {\r\n      const { icon, tabs, ...rest } = details\r\n\r\n      const tabsInfo: { [key: string]: any } = {}\r\n\r\n      for (const tabId of Object.keys(tabs)) {\r\n        const { icon, ...rest } = tabs[tabId]\r\n        tabsInfo[tabId] = rest\r\n      }\r\n\r\n      return {\r\n        id,\r\n        tabs: tabsInfo,\r\n        ...rest,\r\n      }\r\n    })\r\n\r\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\r\n    return { activeTabId: activeTab?.id, actions }\r\n  }\r\n\r\n  private activate({ sender }: ExtensionEvent, details: ActivateDetails) {\r\n    const { eventType, extensionId, tabId } = details\r\n\r\n    debug(\r\n      `activate [eventType: ${eventType}, extensionId: '${extensionId}', tabId: ${tabId}, senderId: ${sender.id}]`\r\n    )\r\n\r\n    switch (eventType) {\r\n      case 'click':\r\n        this.activateClick(details)\r\n        break\r\n      case 'contextmenu':\r\n        this.activateContextMenu(details)\r\n        break\r\n      default:\r\n        console.debug(`Ignoring unknown browserAction.activate event '${eventType}'`)\r\n    }\r\n  }\r\n\r\n  private activateClick(details: ActivateDetails) {\r\n    const { extensionId, tabId, anchorRect } = details\r\n\r\n    if (this.popup) {\r\n      const toggleExtension = !this.popup.isDestroyed() && this.popup.extensionId === extensionId\r\n      this.popup.destroy()\r\n      this.popup = undefined\r\n      if (toggleExtension) {\r\n        debug('skipping activate to close popup')\r\n        return\r\n      }\r\n    }\r\n\r\n    const tab =\r\n      tabId >= 0 ? this.ctx.store.getTabById(tabId) : this.ctx.store.getActiveTabOfCurrentWindow()\r\n    if (!tab) {\r\n      throw new Error(`Unable to get active tab`)\r\n    }\r\n\r\n    const popupUrl = this.getPopupUrl(extensionId, tab.id)\r\n\r\n    if (popupUrl) {\r\n      const win = this.ctx.store.tabToWindow.get(tab)\r\n      if (!win) {\r\n        throw new Error('Unable to get BrowserWindow from active tab')\r\n      }\r\n\r\n      this.popup = new PopupView({\r\n        extensionId,\r\n        session: this.ctx.session,\r\n        parent: win,\r\n        url: popupUrl,\r\n        anchorRect,\r\n      })\r\n\r\n      debug(`opened popup: ${popupUrl}`)\r\n\r\n      this.ctx.emit('browser-action-popup-created', this.popup)\r\n    } else {\r\n      debug(`dispatching onClicked for ${extensionId}`)\r\n\r\n      const tabDetails = this.ctx.store.tabDetailsCache.get(tab.id)\r\n      this.ctx.router.sendEvent(extensionId, 'browserAction.onClicked', tabDetails)\r\n    }\r\n  }\r\n\r\n  private activateContextMenu(details: ActivateDetails) {\r\n    const { extensionId, anchorRect } = details\r\n\r\n    const extension = this.ctx.session.getExtension(extensionId)\r\n    if (!extension) {\r\n      throw new Error(`Unregistered extension '${extensionId}'`)\r\n    }\r\n\r\n    const manifest = getExtensionManifest(extension)\r\n    const menu = new Menu()\r\n    const append = (opts: Electron.MenuItemConstructorOptions) => menu.append(new MenuItem(opts))\r\n    const appendSeparator = () => menu.append(new MenuItem({ type: 'separator' }))\r\n\r\n    append({\r\n      label: extension.name,\r\n      click: () => {\r\n        const homePageUrl =\r\n          manifest.homepage_url || `https://chrome.google.com/webstore/detail/${extension.id}`\r\n        this.ctx.store.createTab({ url: homePageUrl })\r\n      },\r\n    })\r\n\r\n    appendSeparator()\r\n\r\n    const contextMenuItems: MenuItem[] = this.ctx.store.buildMenuItems(\r\n      extensionId,\r\n      'browser_action'\r\n    )\r\n    if (contextMenuItems.length > 0) {\r\n      contextMenuItems.forEach((item) => menu.append(item))\r\n      appendSeparator()\r\n    }\r\n\r\n    const optionsPage = manifest.options_page || manifest.options_ui?.page\r\n    const optionsPageUrl = optionsPage ? getExtensionUrl(extension, optionsPage) : undefined\r\n\r\n    append({\r\n      label: 'Options',\r\n      enabled: typeof optionsPageUrl === 'string',\r\n      click: () => {\r\n        this.ctx.store.createTab({ url: optionsPageUrl })\r\n      },\r\n    })\r\n\r\n    menu.popup({\r\n      x: Math.floor(anchorRect.x),\r\n      y: Math.floor(anchorRect.y + anchorRect.height),\r\n    })\r\n  }\r\n\r\n  private onUpdate() {\r\n    if (this.queuedUpdate) return\r\n    this.queuedUpdate = true\r\n    queueMicrotask(() => {\r\n      this.queuedUpdate = false\r\n      debug(`dispatching update to ${this.observers.size} observer(s)`)\r\n      Array.from(this.observers).forEach((observer) => {\r\n        if (!observer.isDestroyed()) {\r\n          observer.send('browserAction.update')\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n","import { ExtensionContext } from '../context'\r\n\r\n/**\r\n * Stub implementation for chrome.commands API.\r\n */\r\nexport class CommandsAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('commands.getAll', this.getAll)\r\n  }\r\n\r\n  getAll() {\r\n    return []\r\n  }\r\n}\r\n","import { promises as fs } from 'fs'\r\nimport * as path from 'path'\r\nimport { nativeImage } from 'electron'\r\n\r\nexport interface TabContents extends Electron.WebContents {\r\n  favicon?: string\r\n}\r\n\r\nexport type ContextMenuType =\r\n  | 'all'\r\n  | 'page'\r\n  | 'frame'\r\n  | 'selection'\r\n  | 'link'\r\n  | 'editable'\r\n  | 'image'\r\n  | 'video'\r\n  | 'audio'\r\n  | 'launcher'\r\n  | 'browser_action'\r\n  | 'page_action'\r\n  | 'action'\r\n\r\n/**\r\n * Get the extension's properly typed Manifest.\r\n *\r\n * I can't seem to get TS's merged type declarations working so I'm using this\r\n * instead for now.\r\n */\r\nexport const getExtensionManifest = (extension: Electron.Extension): chrome.runtime.Manifest =>\r\n  extension.manifest\r\n\r\nexport const getExtensionUrl = (extension: Electron.Extension, uri: string) => {\r\n  try {\r\n    return new URL(uri, extension.url).href\r\n  } catch {}\r\n}\r\n\r\nexport const resolveExtensionPath = (extension: Electron.Extension, uri: string) => {\r\n  const resPath = path.join(extension.path, uri)\r\n\r\n  // prevent any parent traversals\r\n  if (!resPath.startsWith(extension.path)) return\r\n\r\n  return resPath\r\n}\r\n\r\nexport const validateExtensionResource = async (extension: Electron.Extension, uri: string) => {\r\n  const resPath = resolveExtensionPath(extension, uri)\r\n  if (!resPath) return\r\n\r\n  try {\r\n    await fs.stat(resPath)\r\n  } catch {\r\n    return // doesn't exist\r\n  }\r\n\r\n  return resPath\r\n}\r\n\r\nexport enum ResizeType {\r\n  Exact,\r\n  Up,\r\n  Down,\r\n}\r\n\r\nexport const matchSize = (\r\n  imageSet: { [key: number]: string },\r\n  size: number,\r\n  match: ResizeType\r\n): string | undefined => {\r\n  // TODO: match based on size\r\n  const first = parseInt(Object.keys(imageSet).pop()!, 10)\r\n  return imageSet[first]\r\n}\r\n\r\n/** Gets the relative path to the extension's default icon. */\r\nexport const getIconPath = (\r\n  extension: Electron.Extension,\r\n  iconSize: number = 32,\r\n  resizeType = ResizeType.Up\r\n) => {\r\n  const { browser_action, icons } = getExtensionManifest(extension)\r\n  const { default_icon } = browser_action || {}\r\n\r\n  if (typeof default_icon === 'string') {\r\n    const iconPath = default_icon\r\n    return iconPath\r\n  } else if (typeof default_icon === 'object') {\r\n    const iconPath = matchSize(default_icon, iconSize, resizeType)\r\n    return iconPath\r\n  } else if (typeof icons === 'object') {\r\n    const iconPath = matchSize(icons, iconSize, resizeType)\r\n    return iconPath\r\n  }\r\n}\r\n\r\nexport const getIconImage = (extension: Electron.Extension) => {\r\n  const iconPath = getIconPath(extension)\r\n  const iconAbsolutePath = iconPath && resolveExtensionPath(extension, iconPath)\r\n  return iconAbsolutePath ? nativeImage.createFromPath(iconAbsolutePath) : undefined\r\n}\r\n\r\nconst escapePattern = (pattern: string) => pattern.replace(/[\\\\^$+?.()|[\\]{}]/g, '\\\\$&')\r\n\r\n/**\r\n * @see https://developer.chrome.com/extensions/match_patterns\r\n */\r\nexport const matchesPattern = (pattern: string, url: string) => {\r\n  if (pattern === '<all_urls>') return true\r\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\r\n  return url.match(regexp)\r\n}\r\n","import { Menu, MenuItem } from 'electron'\r\nimport { MenuItemConstructorOptions } from 'electron/main'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { ContextMenuType, getIconImage, matchesPattern } from './common'\r\n\r\ntype ContextItemProps = chrome.contextMenus.CreateProperties & { id: string }\r\n\r\ntype ContextItemConstructorOptions = {\r\n  extension: Electron.Extension\r\n  props: ContextItemProps\r\n  webContents: Electron.WebContents\r\n  params?: Electron.ContextMenuParams\r\n  showIcon?: boolean\r\n}\r\n\r\nconst DEFAULT_CONTEXTS = ['page']\r\n\r\nconst getContextTypesFromParams = (params: Electron.ContextMenuParams): Set<ContextMenuType> => {\r\n  const contexts = new Set<ContextMenuType>(['all'])\r\n\r\n  switch (params.mediaType) {\r\n    case 'audio':\r\n    case 'video':\r\n    case 'image':\r\n      contexts.add(params.mediaType)\r\n  }\r\n\r\n  if (params.pageURL) contexts.add('page')\r\n  if (params.linkURL) contexts.add('link')\r\n  if (params.frameURL) contexts.add('frame')\r\n  if (params.selectionText) contexts.add('selection')\r\n  if (params.isEditable) contexts.add('editable')\r\n\r\n  return contexts\r\n}\r\n\r\nconst formatTitle = (title: string, params: Electron.ContextMenuParams) => {\r\n  if (params.selectionText && title.includes('%s')) {\r\n    title = title.split('%s').join(params.selectionText)\r\n  }\r\n  return title\r\n}\r\n\r\nconst matchesConditions = (\r\n  props: ContextItemProps,\r\n  conditions: {\r\n    contextTypes: Set<ContextMenuType>\r\n    targetUrl?: string\r\n    documentUrl?: string\r\n  }\r\n) => {\r\n  if (props.visible === false) return false\r\n\r\n  const { contextTypes, targetUrl, documentUrl } = conditions\r\n\r\n  const contexts = props.contexts || DEFAULT_CONTEXTS\r\n  const inContext = contexts.some((context) => contextTypes.has(context as ContextMenuType))\r\n  if (!inContext) return false\r\n\r\n  if (props.targetUrlPatterns && props.targetUrlPatterns.length > 0 && targetUrl) {\r\n    if (!props.targetUrlPatterns.some((pattern) => matchesPattern(pattern, targetUrl))) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  if (props.documentUrlPatterns && props.documentUrlPatterns.length > 0 && documentUrl) {\r\n    if (!props.documentUrlPatterns.some((pattern) => matchesPattern(pattern, documentUrl))) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nexport class ContextMenusAPI {\r\n  private menus = new Map<\r\n    /* extensionId */ string,\r\n    Map</* menuItemId */ string, ContextItemProps>\r\n  >()\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('contextMenus.create', this.create)\r\n    handle('contextMenus.remove', this.remove)\r\n    handle('contextMenus.removeAll', this.removeAll)\r\n\r\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\r\n      if (this.menus.has(extension.id)) {\r\n        this.menus.delete(extension.id)\r\n      }\r\n    })\r\n\r\n    this.ctx.store.buildMenuItems = this.buildMenuItemsForExtension.bind(this)\r\n  }\r\n\r\n  private addContextItem(extensionId: string, props: ContextItemProps) {\r\n    let contextItems = this.menus.get(extensionId)\r\n    if (!contextItems) {\r\n      contextItems = new Map()\r\n      this.menus.set(extensionId, contextItems)\r\n    }\r\n    contextItems.set(props.id, props)\r\n  }\r\n\r\n  private buildMenuItem = (opts: ContextItemConstructorOptions) => {\r\n    const { extension, props, webContents, params } = opts\r\n\r\n    // TODO: try to get the appropriately sized image before resizing\r\n    let icon = opts.showIcon ? getIconImage(extension) : undefined\r\n    if (icon) {\r\n      icon = icon.resize({ width: 16, height: 16 })\r\n    }\r\n\r\n    const menuItemOptions: MenuItemConstructorOptions = {\r\n      id: props.id,\r\n      type: props.type as any,\r\n      label: params ? formatTitle(props.title || '', params) : props.title || '',\r\n      icon,\r\n      enabled: props.enabled,\r\n      click: () => {\r\n        this.onClicked(extension.id, props.id, webContents, params)\r\n      },\r\n    }\r\n\r\n    return menuItemOptions\r\n  }\r\n\r\n  private buildMenuItemsFromTemplate = (menuItemTemplates: ContextItemConstructorOptions[]) => {\r\n    const itemMap = new Map<string, MenuItemConstructorOptions>()\r\n\r\n    // Group by ID\r\n    for (const item of menuItemTemplates) {\r\n      const menuItem = this.buildMenuItem(item)\r\n      itemMap.set(item.props.id, menuItem)\r\n    }\r\n\r\n    // Organize in tree\r\n    for (const item of menuItemTemplates) {\r\n      const menuItem = itemMap.get(item.props.id)\r\n      if (item.props.parentId) {\r\n        const parentMenuItem = itemMap.get(item.props.parentId)\r\n        if (parentMenuItem) {\r\n          const submenu = (parentMenuItem.submenu || []) as Electron.MenuItemConstructorOptions[]\r\n          submenu.push(menuItem!)\r\n          parentMenuItem.submenu = submenu\r\n        }\r\n      }\r\n    }\r\n\r\n    const menuItems: Electron.MenuItem[] = []\r\n\r\n    const buildFromTemplate = (opts: Electron.MenuItemConstructorOptions) => {\r\n      if (Array.isArray(opts.submenu)) {\r\n        const submenu = new Menu()\r\n        opts.submenu.forEach((item) => submenu.append(buildFromTemplate(item)))\r\n        opts.submenu = submenu\r\n      }\r\n      return new MenuItem(opts)\r\n    }\r\n\r\n    // Build all final MenuItems in-order\r\n    for (const item of menuItemTemplates) {\r\n      // Items with parents will be handled recursively\r\n      if (item.props.parentId) continue\r\n\r\n      const menuItem = itemMap.get(item.props.id)!\r\n      menuItems.push(buildFromTemplate(menuItem))\r\n    }\r\n\r\n    return menuItems\r\n  }\r\n\r\n  buildMenuItemsForParams(\r\n    webContents: Electron.WebContents,\r\n    params: Electron.ContextMenuParams\r\n  ): Electron.MenuItem[] {\r\n    if (webContents.session !== this.ctx.session) return []\r\n\r\n    const menuItemOptions = []\r\n\r\n    const conditions = {\r\n      contextTypes: getContextTypesFromParams(params),\r\n      targetUrl: params.srcURL || params.linkURL,\r\n      documentUrl: params.frameURL || params.pageURL,\r\n    }\r\n\r\n    for (const [extensionId, propItems] of this.menus) {\r\n      const extension = this.ctx.session.getExtension(extensionId)\r\n      if (!extension) continue\r\n\r\n      for (const [, props] of propItems) {\r\n        if (matchesConditions(props, conditions)) {\r\n          const menuItem = {\r\n            extension,\r\n            props,\r\n            webContents,\r\n            params,\r\n            showIcon: true,\r\n          }\r\n          menuItemOptions.push(menuItem)\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\r\n  }\r\n\r\n  private buildMenuItemsForExtension(\r\n    extensionId: string,\r\n    menuType: ContextMenuType\r\n  ): Electron.MenuItem[] {\r\n    const extensionItems = this.menus.get(extensionId)\r\n    const extension = this.ctx.session.getExtension(extensionId)\r\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\r\n\r\n    const menuItemOptions = []\r\n\r\n    if (extensionItems && extension && activeTab) {\r\n      const conditions = {\r\n        contextTypes: new Set<ContextMenuType>(['all', menuType]),\r\n      }\r\n\r\n      for (const [, props] of extensionItems) {\r\n        if (matchesConditions(props, conditions)) {\r\n          const menuItem = { extension, props, webContents: activeTab }\r\n          menuItemOptions.push(menuItem)\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\r\n  }\r\n\r\n  private create = ({ extension }: ExtensionEvent, createProperties: ContextItemProps) => {\r\n    const { id, type, title } = createProperties\r\n\r\n    if (this.menus.has(id)) {\r\n      // TODO: duplicate error\r\n      return\r\n    }\r\n\r\n    if (!title && type !== 'separator') {\r\n      // TODO: error\r\n      return\r\n    }\r\n\r\n    this.addContextItem(extension.id, createProperties)\r\n  }\r\n\r\n  private remove = ({ extension }: ExtensionEvent, menuItemId: string) => {\r\n    const items = this.menus.get(extension.id)\r\n    if (items && items.has(menuItemId)) {\r\n      items.delete(menuItemId)\r\n      if (items.size === 0) {\r\n        this.menus.delete(extension.id)\r\n      }\r\n    }\r\n  }\r\n\r\n  private removeAll = ({ extension }: ExtensionEvent) => {\r\n    this.menus.delete(extension.id)\r\n  }\r\n\r\n  private onClicked(\r\n    extensionId: string,\r\n    menuItemId: string,\r\n    webContents: Electron.WebContents,\r\n    params?: Electron.ContextMenuParams\r\n  ) {\r\n    if (webContents.isDestroyed()) return\r\n\r\n    const tab = this.ctx.store.tabDetailsCache.get(webContents.id)\r\n    if (!tab) {\r\n      console.error(`[Extensions] Unable to find tab for id=${webContents.id}`)\r\n      return\r\n    }\r\n\r\n    const data: chrome.contextMenus.OnClickData = {\r\n      selectionText: params?.selectionText,\r\n      checked: false, // TODO\r\n      menuItemId,\r\n      frameId: -1, // TODO: match frameURL with webFrameMain in Electron 12\r\n      frameUrl: params?.frameURL,\r\n      editable: params?.isEditable || false,\r\n      mediaType: params?.mediaType,\r\n      wasChecked: false, // TODO\r\n      pageUrl: params?.pageURL as any, // types are inaccurate\r\n      linkUrl: params?.linkURL,\r\n      parentMenuItemId: -1, // TODO\r\n      srcUrl: params?.srcURL,\r\n    }\r\n\r\n    this.ctx.router.sendEvent(extensionId, 'contextMenus.onClicked', data, tab)\r\n  }\r\n}\r\n","import { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\n\r\nenum CookieStoreID {\r\n  Default = '0',\r\n  Incognito = '1',\r\n}\r\n\r\nconst onChangedCauseTranslation: { [key: string]: string } = {\r\n  'expired-overwrite': 'expired_overwrite',\r\n}\r\n\r\nconst createCookieDetails = (cookie: Electron.Cookie): chrome.cookies.Cookie => ({\r\n  ...cookie,\r\n  domain: cookie.domain || '',\r\n  hostOnly: Boolean(cookie.hostOnly),\r\n  session: Boolean(cookie.session),\r\n  path: cookie.path || '',\r\n  httpOnly: Boolean(cookie.httpOnly),\r\n  secure: Boolean(cookie.secure),\r\n  storeId: CookieStoreID.Default,\r\n})\r\n\r\nexport class CookiesAPI {\r\n  private get cookies() {\r\n    return this.ctx.session.cookies\r\n  }\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('cookies.get', this.get.bind(this))\r\n    handle('cookies.getAll', this.getAll.bind(this))\r\n    handle('cookies.set', this.set.bind(this))\r\n    handle('cookies.remove', this.remove.bind(this))\r\n    handle('cookies.getAllCookieStores', this.getAllCookieStores.bind(this))\r\n\r\n    this.cookies.addListener('changed', this.onChanged)\r\n  }\r\n\r\n  private async get(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.Details\r\n  ): Promise<chrome.cookies.Cookie | null> {\r\n    // TODO: storeId\r\n    const cookies = await this.cookies.get({\r\n      url: details.url,\r\n      name: details.name,\r\n    })\r\n\r\n    // TODO: If more than one cookie of the same name exists for the given URL,\r\n    // the one with the longest path will be returned. For cookies with the\r\n    // same path length, the cookie with the earliest creation time will be returned.\r\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\r\n  }\r\n\r\n  private async getAll(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.GetAllDetails\r\n  ): Promise<chrome.cookies.Cookie[]> {\r\n    // TODO: storeId\r\n    const cookies = await this.cookies.get({\r\n      url: details.url,\r\n      name: details.name,\r\n      domain: details.domain,\r\n      path: details.path,\r\n      secure: details.secure,\r\n      session: details.session,\r\n    })\r\n\r\n    return cookies.map(createCookieDetails)\r\n  }\r\n\r\n  private async set(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.SetDetails\r\n  ): Promise<chrome.cookies.Cookie | null> {\r\n    await this.cookies.set(details)\r\n    const cookies = await this.cookies.get(details)\r\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\r\n  }\r\n\r\n  private async remove(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.Details\r\n  ): Promise<chrome.cookies.Details | null> {\r\n    try {\r\n      await this.cookies.remove(details.url, details.name)\r\n    } catch {\r\n      return null\r\n    }\r\n    return details\r\n  }\r\n\r\n  private async getAllCookieStores(event: ExtensionEvent): Promise<chrome.cookies.CookieStore[]> {\r\n    const tabIds = Array.from(this.ctx.store.tabs)\r\n      .map((tab) => (tab.isDestroyed() ? undefined : tab.id))\r\n      .filter(Boolean) as number[]\r\n    return [{ id: CookieStoreID.Default, tabIds }]\r\n  }\r\n\r\n  private onChanged = (event: Event, cookie: Electron.Cookie, cause: string, removed: boolean) => {\r\n    const changeInfo: chrome.cookies.CookieChangeInfo = {\r\n      cause: onChangedCauseTranslation[cause] || cause,\r\n      cookie: createCookieDetails(cookie),\r\n      removed,\r\n    }\r\n\r\n    this.ctx.router.broadcastEvent('cookies.onChanged', changeInfo)\r\n  }\r\n}\r\n","import {ExtensionContext} from '../context'\r\nimport {ExtensionEvent} from \"../router\";\r\nimport {getExtensionManifest, resolveExtensionPath} from \"./common\";\r\nimport {app} from 'electron';\r\n\r\nconst fs = eval('require')('fs')\r\nconst path = eval('require')('path')\r\n\r\n/**\r\n * Stub implementation for chrome.i18n API.\r\n */\r\nexport class I18nAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('i18n.getAllMessage', this.getAllMessage.bind(this))\r\n  }\r\n\r\n  private getAllMessage(event: ExtensionEvent) {\r\n    let manifest = getExtensionManifest(event.extension)\r\n    let localeName = app.getLocale().replace('-', '_')\r\n    let localePath = resolveExtensionPath(event.extension, '_locales')\r\n    if (!fs.existsSync(localePath)) {\r\n      return {}\r\n    }\r\n    let message: String = ''\r\n    if (fs.existsSync(path.join(localePath, localeName))) {\r\n      //\r\n      message = path.join(localePath, localeName)\r\n      //\r\n    } else {\r\n      //\r\n      message = path.join(localePath, manifest['default_locale'])\r\n    }\r\n    let file = path.join(message, 'messages.json')\r\n    let localeJson: Object\r\n    try{\r\n      var con=fs.readFileSync(file, 'utf8')\r\n      localeJson= JSON.parse(con.trim())\r\n    }catch (e) {\r\n      console.warn(e)\r\n      localeJson=[]\r\n    }\r\n    return localeJson\r\n  }\r\n}\r\n\r\n\r\n\r\n","import { app, Extension, Notification } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { validateExtensionResource } from './common'\r\n\r\nenum TemplateType {\r\n  Basic = 'basic',\r\n  Image = 'image',\r\n  List = 'list',\r\n  Progress = 'progress',\r\n}\r\n\r\nconst getBody = (opts: chrome.notifications.NotificationOptions) => {\r\n  const { type = TemplateType.Basic } = opts\r\n\r\n  switch (type) {\r\n    case TemplateType.List: {\r\n      if (!Array.isArray(opts.items)) {\r\n        throw new Error('List items must be provided for list type')\r\n      }\r\n      return opts.items.map((item) => `${item.title} - ${item.message}`).join('\\n')\r\n    }\r\n    default:\r\n      return opts.message || ''\r\n  }\r\n}\r\n\r\nconst getUrgency = (\r\n  priority?: number\r\n): Required<Electron.NotificationConstructorOptions>['urgency'] => {\r\n  if (typeof priority !== 'number') {\r\n    return 'normal'\r\n  } else if (priority >= 2) {\r\n    return 'critical'\r\n  } else if (priority < 0) {\r\n    return 'low'\r\n  } else {\r\n    return 'normal'\r\n  }\r\n}\r\n\r\nconst createScopedIdentifier = (extension: Extension, id: string) => `${extension.id}-${id}`\r\nconst stripScopeFromIdentifier = (id: string) => {\r\n  const index = id.indexOf('-')\r\n  return id.substr(index + 1)\r\n}\r\n\r\nexport class NotificationsAPI {\r\n  private registry = new Map<string, Notification>()\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('notifications.clear', this.clear)\r\n    handle('notifications.create', this.create)\r\n    handle('notifications.getAll', this.getAll)\r\n    handle('notifications.getPermissionLevel', this.getPermissionLevel)\r\n    handle('notifications.update', this.update)\r\n\r\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\r\n      for (const [key, notification] of this.registry) {\r\n        if (key.startsWith(extension.id)) {\r\n          notification.close()\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private clear = ({ extension }: ExtensionEvent, id: string) => {\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n    if (this.registry.has(notificationId)) {\r\n      this.registry.get(notificationId)?.close()\r\n    }\r\n  }\r\n\r\n  private create = async ({ extension }: ExtensionEvent, arg1: unknown, arg2?: unknown) => {\r\n    let id: string\r\n    let opts: chrome.notifications.NotificationOptions\r\n\r\n    if (typeof arg1 === 'object') {\r\n      id = 'guid' // TODO: generate uuid\r\n      opts = arg1 as chrome.notifications.NotificationOptions\r\n    } else if (typeof arg1 === 'string') {\r\n      id = arg1\r\n      opts = arg2 as chrome.notifications.NotificationOptions\r\n    } else {\r\n      throw new Error('Invalid arguments')\r\n    }\r\n\r\n    if (typeof opts !== 'object' || !opts.type || !opts.iconUrl || !opts.title || !opts.message) {\r\n      throw new Error('Missing required notification options')\r\n    }\r\n\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n\r\n    if (this.registry.has(notificationId)) {\r\n      this.registry.get(notificationId)?.close()\r\n    }\r\n\r\n    let icon\r\n\r\n    if (opts.iconUrl) {\r\n      let url\r\n      try {\r\n        url = new URL(opts.iconUrl)\r\n      } catch {}\r\n\r\n      if (url?.protocol === 'data:') {\r\n        icon = opts.iconUrl\r\n      } else {\r\n        icon = await validateExtensionResource(extension, opts.iconUrl)\r\n      }\r\n\r\n      if (!icon) {\r\n        throw new Error('Invalid iconUrl')\r\n      }\r\n    }\r\n\r\n    // TODO: buttons, template types\r\n\r\n    const notification = new Notification({\r\n      title: opts.title,\r\n      subtitle: app.name,\r\n      body: getBody(opts),\r\n      silent: opts.silent,\r\n      icon,\r\n      urgency: getUrgency(opts.priority),\r\n      timeoutType: opts.requireInteraction ? 'never' : 'default',\r\n    })\r\n\r\n    this.registry.set(notificationId, notification)\r\n\r\n    notification.on('click', () => {\r\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClicked', id)\r\n    })\r\n\r\n    notification.once('close', () => {\r\n      const byUser = true // TODO\r\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClosed', id, byUser)\r\n      this.registry.delete(notificationId)\r\n    })\r\n\r\n    notification.show()\r\n\r\n    return id\r\n  }\r\n\r\n  private getAll = ({ extension }: ExtensionEvent) => {\r\n    return Array.from(this.registry.keys())\r\n      .filter((key) => key.startsWith(extension.id))\r\n      .map(stripScopeFromIdentifier)\r\n  }\r\n\r\n  private getPermissionLevel = (event: ExtensionEvent) => {\r\n    return Notification.isSupported() ? 'granted' : 'denied'\r\n  }\r\n\r\n  private update = (\r\n    { extension }: ExtensionEvent,\r\n    id: string,\r\n    opts: chrome.notifications.NotificationOptions\r\n  ) => {\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n\r\n    const notification = this.registry.get(notificationId)\r\n\r\n    if (!notification) {\r\n      return false\r\n    }\r\n\r\n    // TODO: remaining opts\r\n\r\n    if (opts.priority) notification.urgency = getUrgency(opts.priority)\r\n    if (opts.silent) notification.silent = opts.silent\r\n  }\r\n}\r\n","import { ExtensionContext } from '../context'\r\nimport {ExtensionEvent} from \"../router\";\r\n\r\n/**\r\n * Stub implementation for chrome.commands API.\r\n */\r\nexport class PermissionsAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('permissions.contains', this.contains.bind(this))\r\n  }\r\n\r\n  private async contains(event: ExtensionEvent,permissions:Array<String>) {\r\n    //todo permissions\r\n    return true\r\n  }\r\n}\r\n","import { EventEmitter } from 'events'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { getExtensionManifest } from './common'\r\n\r\nexport class RuntimeAPI extends EventEmitter {\r\n  constructor(private ctx: ExtensionContext) {\r\n    super()\r\n\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('runtime.openOptionsPage', this.openOptionsPage)\r\n  }\r\n\r\n  private openOptionsPage = async ({ extension }: ExtensionEvent) => {\r\n    // TODO: options page shouldn't appear in Tabs API\r\n    // https://developer.chrome.com/extensions/options#tabs-api\r\n\r\n    const manifest = getExtensionManifest(extension)\r\n\r\n    if (manifest.options_ui) {\r\n      // Embedded option not support (!options_ui.open_in_new_tab)\r\n      const url = `chrome-extension://${extension.id}/${manifest.options_ui.page}`\r\n      await this.ctx.store.createTab({ url, active: true })\r\n    } else if (manifest.options_page) {\r\n      const url = `chrome-extension://${extension.id}/${manifest.options_page}`\r\n      await this.ctx.store.createTab({ url, active: true })\r\n    }\r\n  }\r\n}\r\n","import { BrowserWindow } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { TabContents } from './common'\r\nimport { WindowsAPI } from './windows'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:tabs')\r\n\r\nexport class TabsAPI {\r\n  static TAB_ID_NONE = -1\r\n  static WINDOW_ID_NONE = -1\r\n  static WINDOW_ID_CURRENT = -2\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('tabs.get', this.get.bind(this))\r\n    handle('tabs.getAllInWindow', this.getAllInWindow.bind(this))\r\n    handle('tabs.getSelected', this.getSelected.bind(this))\r\n    handle('tabs.getCurrent', this.getCurrent.bind(this))\r\n    handle('tabs.create', this.create.bind(this))\r\n    handle('tabs.insertCSS', this.insertCSS.bind(this))\r\n    handle('tabs.query', this.query.bind(this))\r\n    handle('tabs.reload', this.reload.bind(this))\r\n    handle('tabs.update', this.update.bind(this))\r\n    handle('tabs.remove', this.remove.bind(this))\r\n    handle('tabs.goForward', this.goForward.bind(this))\r\n    handle('tabs.goBack', this.goBack.bind(this))\r\n\r\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\r\n  }\r\n\r\n  private observeTab(tab: TabContents) {\r\n    const tabId = tab.id\r\n\r\n    const updateEvents = [\r\n      'page-title-updated', // title\r\n      'did-start-loading', // status\r\n      'did-stop-loading', // status\r\n      'media-started-playing', // audible\r\n      'media-paused', // audible\r\n      'did-start-navigation', // url\r\n      'did-redirect-navigation', // url\r\n      'did-navigate-in-page', // url\r\n    ]\r\n\r\n    const updateHandler = () => {\r\n      this.onUpdated(tabId)\r\n    }\r\n\r\n    updateEvents.forEach((eventName) => {\r\n      tab.on(eventName as any, updateHandler)\r\n    })\r\n\r\n    const faviconHandler = (event: Electron.Event, favicons: string[]) => {\r\n      ;(tab as TabContents).favicon = favicons[0]\r\n      this.onUpdated(tabId)\r\n    }\r\n    tab.on('page-favicon-updated', faviconHandler)\r\n\r\n    tab.once('destroyed', () => {\r\n      updateEvents.forEach((eventName) => {\r\n        tab.off(eventName as any, updateHandler)\r\n      })\r\n      tab.off('page-favicon-updated', faviconHandler)\r\n\r\n      this.ctx.store.removeTab(tab)\r\n      this.onRemoved(tabId)\r\n    })\r\n\r\n    this.onCreated(tabId)\r\n    this.onActivated(tabId)\r\n\r\n    debug(`Observing tab[${tabId}][${tab.getType()}] ${tab.getURL()}`)\r\n  }\r\n\r\n  private createTabDetails(tab: TabContents) {\r\n    const tabId = tab.id\r\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\r\n    let win = this.ctx.store.tabToWindow.get(tab)\r\n    if (win?.isDestroyed()) win = undefined\r\n    const [width = 0, height = 0] = win ? win.getSize() : []\r\n\r\n    const details: chrome.tabs.Tab = {\r\n      active: activeTab?.id === tabId,\r\n      audible: tab.isCurrentlyAudible(),\r\n      autoDiscardable: true,\r\n      discarded: false,\r\n      favIconUrl: tab.favicon || undefined,\r\n      height,\r\n      highlighted: false,\r\n      id: tabId,\r\n      incognito: false,\r\n      index: -1, // TODO\r\n      mutedInfo: { muted: tab.audioMuted },\r\n      pinned: false,\r\n      selected: true,\r\n      status: tab.isLoading() ? 'loading' : 'complete',\r\n      title: tab.getTitle(),\r\n      url: tab.getURL(), // TODO: tab.mainFrame.url (Electron 12)\r\n      width,\r\n      windowId: win ? win.id : -1,\r\n    }\r\n\r\n    if (typeof this.ctx.store.impl.assignTabDetails === 'function') {\r\n      this.ctx.store.impl.assignTabDetails(details, tab)\r\n    }\r\n\r\n    this.ctx.store.tabDetailsCache.set(tab.id, details)\r\n    return details\r\n  }\r\n\r\n  private getTabDetails(tab: TabContents) {\r\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\r\n      return this.ctx.store.tabDetailsCache.get(tab.id)\r\n    }\r\n    const details = this.createTabDetails(tab)\r\n    return details\r\n  }\r\n\r\n  private get(event: ExtensionEvent, tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return { id: TabsAPI.TAB_ID_NONE }\r\n    return this.getTabDetails(tab)\r\n  }\r\n\r\n  private getAllInWindow(event: ExtensionEvent, windowId: number = TabsAPI.WINDOW_ID_CURRENT) {\r\n    if (windowId === TabsAPI.WINDOW_ID_CURRENT) windowId = this.ctx.store.lastFocusedWindowId!\r\n\r\n    const tabs = Array.from(this.ctx.store.tabs).filter((tab) => {\r\n      if (tab.isDestroyed()) return false\r\n\r\n      const browserWindow = this.ctx.store.tabToWindow.get(tab)\r\n      if (!browserWindow || browserWindow.isDestroyed()) return\r\n\r\n      return browserWindow.id === windowId\r\n    })\r\n\r\n    return tabs.map(this.getTabDetails.bind(this))\r\n  }\r\n\r\n  private getCurrent(event: ExtensionEvent) {\r\n    const tab = this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    return tab ? this.getTabDetails(tab) : undefined\r\n  }\r\n\r\n  private async getSelected(event: ExtensionEvent){\r\n    return this.query(event,{active:true})[0]\r\n  }\r\n\r\n  private async create(event: ExtensionEvent, details: chrome.tabs.CreateProperties = {}) {\r\n    const tab = await this.ctx.store.createTab(details)\r\n    const tabDetails = this.getTabDetails(tab)\r\n    if (details.active) {\r\n      queueMicrotask(() => this.onActivated(tab.id))\r\n    }\r\n    return tabDetails\r\n  }\r\n\r\n  private insertCSS(event: ExtensionEvent, tabId: number, details: chrome.tabs.InjectDetails) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    // TODO: move to webFrame in renderer?\r\n    if (details.code) {\r\n      tab.insertCSS(details.code)\r\n    }\r\n  }\r\n\r\n  private query(event: ExtensionEvent, info: chrome.tabs.QueryInfo = {}) {\r\n    const isSet = (value: any) => typeof value !== 'undefined'\r\n\r\n    const filteredTabs = Array.from(this.ctx.store.tabs)\r\n      .map(this.getTabDetails.bind(this))\r\n      .filter((tab) => {\r\n        if (!tab) return false\r\n        if (isSet(info.active) && info.active !== tab.active) return false\r\n        if (isSet(info.pinned) && info.pinned !== tab.pinned) return false\r\n        if (isSet(info.audible) && info.audible !== tab.audible) return false\r\n        if (isSet(info.muted) && info.muted !== tab.mutedInfo?.muted) return false\r\n        if (isSet(info.highlighted) && info.highlighted !== tab.highlighted) return false\r\n        if (isSet(info.discarded) && info.discarded !== tab.discarded) return false\r\n        if (isSet(info.autoDiscardable) && info.autoDiscardable !== tab.autoDiscardable)\r\n          return false\r\n        // if (isSet(info.currentWindow)) return false\r\n        // if (isSet(info.lastFocusedWindow)) return false\r\n        if (isSet(info.status) && info.status !== tab.status) return false\r\n        if (isSet(info.title) && info.title !== tab.title) return false // TODO: pattern match\r\n        if (isSet(info.url) && info.url !== tab.url) return false // TODO: match URL pattern\r\n        if (isSet(info.windowId)) {\r\n          if (info.windowId === TabsAPI.WINDOW_ID_CURRENT) {\r\n            if (this.ctx.store.lastFocusedWindowId !== tab.windowId) return false\r\n          } else if (info.windowId !== tab.windowId) {\r\n            return false\r\n          }\r\n        }\r\n        // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\r\n        // if (isSet(info.index) && info.index !== tab.index) return false\r\n        return true\r\n      })\r\n      .map((tab, index) => {\r\n        if (tab) {\r\n          tab.index = index\r\n        }\r\n        return tab\r\n      })\r\n    return filteredTabs\r\n  }\r\n\r\n  private reload(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\r\n    const tabId: number | undefined = typeof arg1 === 'number' ? arg1 : undefined\r\n    const reloadProperties: chrome.tabs.ReloadProperties | null =\r\n      typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : {}\r\n\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n\r\n    if (!tab) return\r\n\r\n    if (reloadProperties?.bypassCache) {\r\n      tab.reloadIgnoringCache()\r\n    } else {\r\n      tab.reload()\r\n    }\r\n  }\r\n\r\n  private async update(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\r\n    let tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const updateProperties: chrome.tabs.UpdateProperties =\r\n      (typeof arg1 === 'object' ? (arg1 as any) : (arg2 as any)) || {}\r\n\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n\r\n    tabId = tab.id\r\n\r\n    const props = updateProperties\r\n\r\n    // TODO: validate URL, prevent 'javascript:'\r\n    if (props.url) await tab.loadURL(props.url)\r\n\r\n    if (typeof props.muted === 'boolean') tab.setAudioMuted(props.muted)\r\n\r\n    if (props.active) this.onActivated(tabId)\r\n\r\n    this.onUpdated(tabId)\r\n\r\n    return this.createTabDetails(tab)\r\n  }\r\n\r\n  private remove(event: ExtensionEvent, id: number | number[]) {\r\n    const ids = Array.isArray(id) ? id : [id]\r\n\r\n    ids.forEach((tabId) => {\r\n      const tab = this.ctx.store.getTabById(tabId)\r\n      if (tab) this.ctx.store.removeTab(tab)\r\n      this.onRemoved(tabId)\r\n    })\r\n  }\r\n\r\n  private goForward(event: ExtensionEvent, arg1?: unknown) {\r\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n    tab.goForward()\r\n  }\r\n\r\n  private goBack(event: ExtensionEvent, arg1?: unknown) {\r\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n    tab.goBack()\r\n  }\r\n\r\n  onCreated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n    const tabDetails = this.getTabDetails(tab)\r\n    this.ctx.router.broadcastEvent('tabs.onCreated', tabDetails)\r\n  }\r\n\r\n  onUpdated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    let prevDetails\r\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\r\n      prevDetails = this.ctx.store.tabDetailsCache.get(tab.id)\r\n    }\r\n    if (!prevDetails) return\r\n\r\n    const details = this.createTabDetails(tab)\r\n\r\n    const compareProps: (keyof chrome.tabs.Tab)[] = [\r\n      'status',\r\n      'url',\r\n      'pinned',\r\n      'audible',\r\n      'discarded',\r\n      'autoDiscardable',\r\n      'mutedInfo',\r\n      'favIconUrl',\r\n      'title',\r\n    ]\r\n\r\n    let didUpdate = false\r\n    const changeInfo: chrome.tabs.TabChangeInfo = {}\r\n\r\n    for (const prop of compareProps) {\r\n      if (details[prop] !== prevDetails[prop]) {\r\n        ;(changeInfo as any)[prop] = details[prop]\r\n        didUpdate = true\r\n      }\r\n    }\r\n\r\n    if (!didUpdate) return\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onUpdated', tab.id, changeInfo, details)\r\n  }\r\n\r\n  onRemoved(tabId: number) {\r\n    const details = this.ctx.store.tabDetailsCache.has(tabId)\r\n      ? this.ctx.store.tabDetailsCache.get(tabId)\r\n      : null\r\n    this.ctx.store.tabDetailsCache.delete(tabId)\r\n\r\n    const windowId = details ? details.windowId : WindowsAPI.WINDOW_ID_NONE\r\n    const win =\r\n      typeof windowId !== 'undefined' && windowId > -1\r\n        ? BrowserWindow.getAllWindows().find((win) => win.id === windowId)\r\n        : null\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onRemoved', tabId, {\r\n      windowId,\r\n      isWindowClosing: win ? win.isDestroyed() : false,\r\n    })\r\n  }\r\n\r\n  onActivated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\r\n    const activeChanged = activeTab?.id !== tabId\r\n    if (!activeChanged) return\r\n\r\n    const win = this.ctx.store.tabToWindow.get(tab)\r\n\r\n    this.ctx.store.setActiveTab(tab)\r\n\r\n    // invalidate cache since 'active' has changed\r\n    this.ctx.store.tabDetailsCache.forEach((tabInfo, cacheTabId) => {\r\n      tabInfo.active = tabId === cacheTabId\r\n    })\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onActivated', {\r\n      tabId,\r\n      windowId: win?.id,\r\n    })\r\n  }\r\n}\r\n","import * as electron from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:webNavigation')\r\n\r\n// https://github.com/electron/electron/pull/25464\r\nconst getFrame = (frameProcessId: number, frameRoutingId: number) => {\r\n  return (\r\n    ('webFrameMain' in electron &&\r\n      (electron as any).webFrameMain.fromId(frameProcessId, frameRoutingId)) ||\r\n    null\r\n  )\r\n}\r\n\r\nconst getFrameId = (frame: any) =>\r\n  'webFrameMain' in electron ? (frame === frame.top ? 0 : frame.frameTreeNodeId) : -1\r\n\r\nconst getParentFrameId = (frame: any) => {\r\n  const parentFrame = frame?.parent\r\n  return parentFrame ? getFrameId(parentFrame) : -1\r\n}\r\n\r\nconst getFrameDetails = (frame: any) => ({\r\n  errorOccurred: false, // TODO\r\n  processId: frame.processId,\r\n  frameId: getFrameId(frame),\r\n  parentFrameId: getParentFrameId(frame),\r\n  url: frame.url,\r\n})\r\n\r\nexport class WebNavigationAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('webNavigation.getFrame', this.getFrame.bind(this))\r\n    handle('webNavigation.getAllFrames', this.getAllFrames.bind(this))\r\n\r\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\r\n  }\r\n\r\n  private observeTab(tab: Electron.WebContents) {\r\n    tab.once('will-navigate', this.onCreatedNavigationTarget as any)\r\n    tab.on('did-start-navigation', this.onBeforeNavigate as any)\r\n    tab.on('did-frame-finish-load', this.onFinishLoad as any)\r\n    tab.on('did-frame-navigate', this.onCommitted as any)\r\n    tab.on('did-navigate-in-page', this.onHistoryStateUpdated as any)\r\n\r\n    tab.on('frame-created', (e, { frame }) => {\r\n      if (frame.top === frame) return\r\n\r\n      frame.on('dom-ready', () => {\r\n        this.onDOMContentLoaded(tab, frame)\r\n      })\r\n    })\r\n\r\n    // Main frame dom-ready event\r\n    tab.on('dom-ready', () => {\r\n      if ('mainFrame' in tab) {\r\n        this.onDOMContentLoaded(tab, tab.mainFrame)\r\n      }\r\n    })\r\n  }\r\n\r\n  private getFrame(\r\n    event: ExtensionEvent,\r\n    details: chrome.webNavigation.GetFrameDetails\r\n  ): chrome.webNavigation.GetFrameResultDetails | null {\r\n    const tab = this.ctx.store.getTabById(details.tabId)\r\n    if (!tab) return null\r\n\r\n    let targetFrame: any\r\n\r\n    if (typeof details.frameId === 'number') {\r\n      // https://github.com/electron/electron/pull/25464\r\n      if ('mainFrame' in tab) {\r\n        const mainFrame = (tab as any).mainFrame\r\n        targetFrame = mainFrame.framesInSubtree.find((frame: any) => {\r\n          const isMainFrame = frame === frame.top\r\n          return isMainFrame ? details.frameId === 0 : details.frameId === frame.frameTreeNodeId\r\n        })\r\n      }\r\n    }\r\n\r\n    return targetFrame ? getFrameDetails(targetFrame) : null\r\n  }\r\n\r\n  private getAllFrames(\r\n    event: ExtensionEvent,\r\n    details: chrome.webNavigation.GetFrameDetails\r\n  ): chrome.webNavigation.GetAllFrameResultDetails[] | null {\r\n    const tab = this.ctx.store.getTabById(details.tabId)\r\n    if (!tab || !('mainFrame' in tab)) return []\r\n    return (tab as any).mainFrame.framesInSubtree.map(getFrameDetails)\r\n  }\r\n\r\n  private sendNavigationEvent = (eventName: string, details: { url: string }) => {\r\n    debug(`${eventName} [url: ${details.url}]`)\r\n    this.ctx.router.broadcastEvent(`webNavigation.${eventName}`, details)\r\n  }\r\n\r\n  private onCreatedNavigationTarget = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isInPlace: boolean,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationSourceCallbackDetails = {\r\n      sourceTabId: tab.id,\r\n      sourceProcessId: frameProcessId,\r\n      sourceFrameId: getFrameId(frame),\r\n      url,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n    }\r\n    this.sendNavigationEvent('onCreatedNavigationTarget', details)\r\n  }\r\n\r\n  private onBeforeNavigate = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isInPlace: number,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    if (isInPlace) return\r\n\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n\r\n    this.sendNavigationEvent('onBeforeNavigate', details)\r\n  }\r\n\r\n  private onCommitted = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    httpResponseCode: number,\r\n    httpStatusText: string,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onCommitted', details)\r\n  }\r\n\r\n  private onHistoryStateUpdated = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationTransitionCallbackDetails & {\r\n      parentFrameId: number\r\n    } = {\r\n      transitionType: '', // TODO\r\n      transitionQualifiers: [], // TODO\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onHistoryStateUpdated', details)\r\n  }\r\n\r\n  private onDOMContentLoaded = (tab: Electron.WebContents, frame: Electron.WebFrameMain) => {\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frame.processId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url: frame.url,\r\n    }\r\n    this.sendNavigationEvent('onDOMContentLoaded', details)\r\n\r\n    if (!tab.isLoadingMainFrame()) {\r\n      this.sendNavigationEvent('onCompleted', details)\r\n    }\r\n  }\r\n\r\n  private onFinishLoad = (\r\n    event: Electron.IpcMainEvent,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const url = tab.getURL()\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onCompleted', details)\r\n  }\r\n}\r\n","import { BrowserWindow } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:windows')\r\n\r\nconst getWindowState = (win: BrowserWindow): chrome.windows.Window['state'] => {\r\n  if (win.isMaximized()) return 'maximized'\r\n  if (win.isMinimized()) return 'minimized'\r\n  if (win.isFullScreen()) return 'fullscreen'\r\n  return 'normal'\r\n}\r\n\r\nexport class WindowsAPI {\r\n  static WINDOW_ID_NONE = -1\r\n  static WINDOW_ID_CURRENT = -2\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('windows.get', this.get.bind(this))\r\n    // TODO: how does getCurrent differ from getLastFocused?\r\n    handle('windows.getCurrent', this.getLastFocused.bind(this))\r\n    handle('windows.getLastFocused', this.getLastFocused.bind(this))\r\n    handle('windows.getAll', this.getAll.bind(this))\r\n    handle('windows.create', this.create.bind(this))\r\n    handle('windows.update', this.update.bind(this))\r\n    handle('windows.remove', this.remove.bind(this))\r\n\r\n    this.ctx.store.on('window-added', this.observeWindow.bind(this))\r\n  }\r\n\r\n  private observeWindow(window: Electron.BrowserWindow) {\r\n    const windowId = window.id\r\n\r\n    window.on('focus', () => {\r\n      this.onFocusChanged(windowId)\r\n    })\r\n\r\n    window.once('closed', () => {\r\n      this.ctx.store.windowDetailsCache.delete(windowId)\r\n      this.ctx.store.removeWindow(window)\r\n      this.onRemoved(windowId)\r\n    })\r\n\r\n    this.onCreated(windowId)\r\n\r\n    debug(`Observing window[${windowId}]`)\r\n  }\r\n\r\n  private createWindowDetails(win: BrowserWindow) {\r\n    const details: Partial<chrome.windows.Window> = {\r\n      id: win.id,\r\n      focused: win.isFocused(),\r\n      top: win.getPosition()[1],\r\n      left: win.getPosition()[0],\r\n      width: win.getSize()[0],\r\n      height: win.getSize()[1],\r\n      tabs: Array.from(this.ctx.store.tabs)\r\n        .filter((tab) => {\r\n          const ownerWindow = this.ctx.store.tabToWindow.get(tab)\r\n          return ownerWindow?.isDestroyed() ? false : ownerWindow?.id === win.id\r\n        })\r\n        .map((tab) => this.ctx.store.tabDetailsCache.get(tab.id) as chrome.tabs.Tab)\r\n        .filter(Boolean),\r\n      incognito: !win.webContents.session.isPersistent(),\r\n      type: 'normal', // TODO\r\n      state: getWindowState(win),\r\n      alwaysOnTop: win.isAlwaysOnTop(),\r\n      sessionId: 'default', // TODO\r\n    }\r\n\r\n    this.ctx.store.windowDetailsCache.set(win.id, details)\r\n    return details\r\n  }\r\n\r\n  private getWindowDetails(win: BrowserWindow) {\r\n    if (this.ctx.store.windowDetailsCache.has(win.id)) {\r\n      return this.ctx.store.windowDetailsCache.get(win.id)\r\n    }\r\n    const details = this.createWindowDetails(win)\r\n    return details\r\n  }\r\n\r\n  private getWindowFromId(id: number) {\r\n    if (id === WindowsAPI.WINDOW_ID_CURRENT) {\r\n      return this.ctx.store.getCurrentWindow()\r\n    } else {\r\n      return this.ctx.store.getWindowById(id)\r\n    }\r\n  }\r\n\r\n  private get(event: ExtensionEvent, windowId: number) {\r\n    const win = this.getWindowFromId(windowId)\r\n    if (!win) return { id: WindowsAPI.WINDOW_ID_NONE }\r\n    return this.getWindowDetails(win)\r\n  }\r\n\r\n  private getLastFocused(event: ExtensionEvent) {\r\n    const win = this.ctx.store.getLastFocusedWindow()\r\n    return win ? this.getWindowDetails(win) : null\r\n  }\r\n\r\n  private getAll(event: ExtensionEvent) {\r\n    return Array.from(this.ctx.store.windows).map(this.getWindowDetails.bind(this))\r\n  }\r\n\r\n  private async create(event: ExtensionEvent, details: chrome.windows.CreateData) {\r\n    const win = await this.ctx.store.createWindow(event, details)\r\n    return this.getWindowDetails(win)\r\n  }\r\n\r\n  private async update(\r\n    event: ExtensionEvent,\r\n    windowId: number,\r\n    updateProperties: chrome.windows.UpdateInfo = {}\r\n  ) {\r\n    const win = this.getWindowFromId(windowId)\r\n    if (!win) return\r\n\r\n    const props = updateProperties\r\n\r\n    if (props.state) {\r\n      switch (props.state) {\r\n        case 'maximized':\r\n          win.maximize()\r\n          break\r\n        case 'minimized':\r\n          win.minimize()\r\n          break\r\n        case 'normal': {\r\n          if (win.isMinimized() || win.isMaximized()) {\r\n            win.restore()\r\n          }\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.createWindowDetails(win)\r\n  }\r\n\r\n  private async remove(event: ExtensionEvent, windowId: number = WindowsAPI.WINDOW_ID_CURRENT) {\r\n    const win = this.getWindowFromId(windowId)\r\n    if (!win) return\r\n    const removedWindowId = win.id\r\n    await this.ctx.store.removeWindow(win)\r\n    this.onRemoved(removedWindowId)\r\n  }\r\n\r\n  onCreated(windowId: number) {\r\n    const window = this.ctx.store.getWindowById(windowId)\r\n    if (!window) return\r\n    const windowDetails = this.getWindowDetails(window)\r\n    this.ctx.router.broadcastEvent('windows.onCreated', windowDetails)\r\n  }\r\n\r\n  onRemoved(windowId: number) {\r\n    this.ctx.router.broadcastEvent('windows.onRemoved', windowId)\r\n  }\r\n\r\n  onFocusChanged(windowId: number) {\r\n    if (this.ctx.store.lastFocusedWindowId === windowId) return\r\n\r\n    this.ctx.store.lastFocusedWindowId = windowId\r\n    this.ctx.router.broadcastEvent('windows.onFocusChanged', windowId)\r\n  }\r\n}\r\n","import { app, session as electronSession } from 'electron'\r\nimport { EventEmitter } from 'events'\r\nimport path from 'path'\r\nimport { promises as fs } from 'fs'\r\n\r\nimport { BrowserActionAPI } from './api/browser-action'\r\nimport { TabsAPI } from './api/tabs'\r\nimport { WindowsAPI } from './api/windows'\r\nimport { WebNavigationAPI } from './api/web-navigation'\r\nimport { ExtensionStore } from './store'\r\nimport { ContextMenusAPI } from './api/context-menus'\r\nimport { RuntimeAPI } from './api/runtime'\r\nimport { CookiesAPI } from './api/cookies'\r\nimport { NotificationsAPI } from './api/notifications'\r\nimport { ChromeExtensionImpl } from './impl'\r\nimport { CommandsAPI } from './api/commands'\r\nimport { ExtensionContext } from './context'\r\nimport { ExtensionRouter } from './router'\r\nimport { PermissionsAPI } from \"./api/permissions\";\r\nimport { I18nAPI } from './api/i18n';\r\n\r\nexport interface ChromeExtensionOptions extends ChromeExtensionImpl {\r\n  session?: Electron.Session\r\n\r\n  /**\r\n   * Path to electron-chrome-extensions module files. Might be needed if\r\n   * JavaScript bundlers like Webpack are used in your build process.\r\n   */\r\n  modulePath?: string\r\n}\r\n\r\nconst sessionMap = new WeakMap<Electron.Session, ElectronChromeExtensions>()\r\n\r\n/**\r\n * Provides an implementation of various Chrome extension APIs to a session.\r\n */\r\nexport class ElectronChromeExtensions extends EventEmitter {\r\n  /** Retrieve an instance of this class associated with the given session. */\r\n  static fromSession(session: Electron.Session) {\r\n    return sessionMap.get(session)\r\n  }\r\n\r\n  private ctx: ExtensionContext\r\n  private modulePath: string\r\n\r\n  private api: {\r\n    browserAction: BrowserActionAPI\r\n    contextMenus: ContextMenusAPI\r\n    commands: CommandsAPI,\r\n    permissions:PermissionsAPI,\r\n    i18n:I18nAPI,\r\n    cookies: CookiesAPI\r\n    notifications: NotificationsAPI\r\n    runtime: RuntimeAPI\r\n    tabs: TabsAPI\r\n    webNavigation: WebNavigationAPI\r\n    windows: WindowsAPI\r\n  }\r\n\r\n  constructor(opts?: ChromeExtensionOptions) {\r\n    super()\r\n\r\n    const { session = electronSession.defaultSession, modulePath, ...impl } = opts || {}\r\n\r\n    if (sessionMap.has(session)) {\r\n      throw new Error(`Extensions instance already exists for the given session`)\r\n    }\r\n\r\n    sessionMap.set(session, this)\r\n\r\n    const router = new ExtensionRouter(session)\r\n    const store = new ExtensionStore(impl)\r\n\r\n    this.ctx = {\r\n      emit: this.emit.bind(this),\r\n      router,\r\n      session,\r\n      store,\r\n    }\r\n\r\n    this.modulePath = modulePath || path.join(__dirname, '..')\r\n\r\n    this.api = {\r\n      browserAction: new BrowserActionAPI(this.ctx),\r\n      contextMenus: new ContextMenusAPI(this.ctx),\r\n      commands: new CommandsAPI(this.ctx),\r\n      permissions:new PermissionsAPI(this.ctx),\r\n      i18n:new I18nAPI(this.ctx),\r\n      cookies: new CookiesAPI(this.ctx),\r\n      notifications: new NotificationsAPI(this.ctx),\r\n      runtime: new RuntimeAPI(this.ctx),\r\n      tabs: new TabsAPI(this.ctx),\r\n      webNavigation: new WebNavigationAPI(this.ctx),\r\n      windows: new WindowsAPI(this.ctx),\r\n    }\r\n\r\n    this.prependPreload()\r\n  }\r\n\r\n  public setupProtocol(session:Electron.Session){\r\n    this.api.browserAction.setupProtocol(session)\r\n  }\r\n\r\n  private async prependPreload() {\r\n    const { session } = this.ctx\r\n    let preloads = session.getPreloads()\r\n\r\n    const preloadPath = path.join(this.modulePath, 'dist/preload.js')\r\n\r\n    const preloadIndex = preloads.indexOf(preloadPath)\r\n    if (preloadIndex > -1) {\r\n      preloads.splice(preloadIndex, 1)\r\n    }\r\n\r\n    preloads = [preloadPath, ...preloads]\r\n    session.setPreloads(preloads)\r\n\r\n    let preloadExists = false\r\n    try {\r\n      const stat = await fs.stat(preloadPath)\r\n      preloadExists = stat.isFile()\r\n    } catch {}\r\n\r\n    if (!preloadExists) {\r\n      console.error(\r\n        `Unable to access electron-chrome-extensions preload file (${preloadPath}). Consider configuring the 'modulePath' constructor option.`\r\n      )\r\n    }\r\n  }\r\n\r\n  /** Add webContents to be tracked as a tab. */\r\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\r\n    this.ctx.store.addTab(tab, window)\r\n  }\r\n\r\n  /** Notify extension system that the active tab has changed. */\r\n  selectTab(tab: Electron.WebContents) {\r\n    if (this.ctx.store.tabs.has(tab)) {\r\n      this.api.tabs.onActivated(tab.id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add webContents to be tracked as an extension host which will receive\r\n   * extension events when a chrome-extension:// resource is loaded.\r\n   *\r\n   * This is usually reserved for extension background pages and popups, but\r\n   * can also be used in other special cases.\r\n   *\r\n   * @deprecated Extension hosts are now tracked lazily when they send\r\n   * extension IPCs to the main process.\r\n   */\r\n  addExtensionHost(host: Electron.WebContents) {\r\n    console.warn('ElectronChromeExtensions.addExtensionHost() is deprecated')\r\n  }\r\n\r\n  /**\r\n   * Get collection of menu items managed by the `chrome.contextMenus` API.\r\n   * @see https://developer.chrome.com/extensions/contextMenus\r\n   */\r\n  getContextMenuItems(webContents: Electron.WebContents, params: Electron.ContextMenuParams) {\r\n    return this.api.contextMenus.buildMenuItemsForParams(webContents, params)\r\n  }\r\n\r\n  /**\r\n   * Add extensions to be visible as an extension action button.\r\n   *\r\n   * @deprecated Not needed in Electron >=12.\r\n   */\r\n  addExtension(extension: Electron.Extension) {\r\n    console.warn('ElectronChromeExtensions.addExtension() is deprecated')\r\n    this.api.browserAction.processExtension(extension)\r\n  }\r\n\r\n  /**\r\n   * Remove extensions from the list of visible extension action buttons.\r\n   *\r\n   * @deprecated Not needed in Electron >=12.\r\n   */\r\n  removeExtension(extension: Electron.Extension) {\r\n    console.warn('ElectronChromeExtensions.removeExtension() is deprecated')\r\n    this.api.browserAction.removeActions(extension.id)\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use `ElectronChromeExtensions` instead.\r\n */\r\nexport const Extensions = ElectronChromeExtensions\r\n","import { BrowserWindow, Session } from 'electron'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:popup')\r\n\r\nexport interface PopupAnchorRect {\r\n  x: number\r\n  y: number\r\n  width: number\r\n  height: number\r\n}\r\n\r\ninterface PopupViewOptions {\r\n  extensionId: string\r\n  session: Session\r\n  parent: BrowserWindow\r\n  url: string\r\n  anchorRect: PopupAnchorRect\r\n}\r\n\r\nexport class PopupView {\r\n  static POSITION_PADDING = 5\r\n\r\n  static BOUNDS = {\r\n    minWidth: 25,\r\n    minHeight: 25,\r\n    maxWidth: 800,\r\n    maxHeight: 600,\r\n  }\r\n\r\n  browserWindow?: BrowserWindow\r\n  parent?: BrowserWindow\r\n  extensionId: string\r\n\r\n  private anchorRect: PopupAnchorRect\r\n  private destroyed: boolean = false\r\n\r\n  /** Preferred size changes are only received in Electron v12+ */\r\n  private usingPreferredSize = false\r\n\r\n  private readyPromise: Promise<void>\r\n\r\n  constructor(opts: PopupViewOptions) {\r\n    this.parent = opts.parent\r\n    this.extensionId = opts.extensionId\r\n    this.anchorRect = opts.anchorRect\r\n\r\n    this.browserWindow = new BrowserWindow({\r\n      show: false,\r\n      frame: false,\r\n      parent: opts.parent,\r\n      movable: false,\r\n      maximizable: false,\r\n      minimizable: false,\r\n      resizable: false,\r\n      skipTaskbar: true,\r\n      backgroundColor: '#ffffff',\r\n      webPreferences: {\r\n        session: opts.session,\r\n        sandbox: true,\r\n        nodeIntegration: false,\r\n        nodeIntegrationInWorker: false,\r\n        nativeWindowOpen: true,\r\n        worldSafeExecuteJavaScript: true,\r\n        contextIsolation: true,\r\n        ...({\r\n          enablePreferredSizeMode: true,\r\n        } as any),\r\n      },\r\n    })\r\n\r\n    const untypedWebContents = this.browserWindow.webContents as any\r\n    untypedWebContents.on('preferred-size-changed', this.updatePreferredSize)\r\n\r\n    this.browserWindow.webContents.on('devtools-closed', this.maybeClose)\r\n    this.browserWindow.on('blur', this.maybeClose)\r\n    this.browserWindow.on('closed', this.destroy)\r\n    this.parent.once('closed', this.destroy)\r\n\r\n    this.readyPromise = this.load(opts.url)\r\n  }\r\n\r\n  private async load(url: string): Promise<void> {\r\n    const win = this.browserWindow!\r\n\r\n    try {\r\n      await win.webContents.loadURL(url)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n\r\n    if (this.destroyed) return\r\n\r\n    if (!this.usingPreferredSize) {\r\n      // Set large initial size to avoid overflow\r\n      this.setSize({ width: PopupView.BOUNDS.maxWidth, height: PopupView.BOUNDS.maxHeight })\r\n\r\n      // Wait for content and layout to load\r\n      await new Promise((resolve) => setTimeout(resolve, 100))\r\n      if (this.destroyed) return\r\n\r\n      await this.queryPreferredSize()\r\n      if (this.destroyed) return\r\n    }\r\n\r\n    win.show()\r\n  }\r\n\r\n  destroy = () => {\r\n    if (this.destroyed) return\r\n\r\n    this.destroyed = true\r\n\r\n    debug(`destroying ${this.extensionId}`)\r\n\r\n    if (this.parent) {\r\n      if (!this.parent.isDestroyed()) {\r\n        this.parent.off('closed', this.destroy)\r\n      }\r\n      this.parent = undefined\r\n    }\r\n\r\n    if (this.browserWindow) {\r\n      if (!this.browserWindow.isDestroyed()) {\r\n        const { webContents } = this.browserWindow\r\n\r\n        if (!webContents.isDestroyed() && webContents.isDevToolsOpened()) {\r\n          webContents.closeDevTools()\r\n        }\r\n\r\n        this.browserWindow.off('closed', this.destroy)\r\n        this.browserWindow.destroy()\r\n      }\r\n\r\n      this.browserWindow = undefined\r\n    }\r\n  }\r\n\r\n  isDestroyed() {\r\n    return this.destroyed\r\n  }\r\n\r\n  /** Resolves when the popup finishes loading. */\r\n  whenReady() {\r\n    return this.readyPromise\r\n  }\r\n\r\n  setSize(rect: Partial<Electron.Rectangle>) {\r\n    if (!this.browserWindow || !this.parent) return\r\n\r\n    const width = Math.floor(\r\n      Math.min(PopupView.BOUNDS.maxWidth, Math.max(rect.width || 0, PopupView.BOUNDS.minWidth))\r\n    )\r\n\r\n    const height = Math.floor(\r\n      Math.min(PopupView.BOUNDS.maxHeight, Math.max(rect.height || 0, PopupView.BOUNDS.minHeight))\r\n    )\r\n\r\n    debug(`setSize`, { width, height })\r\n\r\n    this.browserWindow?.setBounds({\r\n      ...this.browserWindow.getBounds(),\r\n      width,\r\n      height,\r\n    })\r\n  }\r\n\r\n  private maybeClose = () => {\r\n    // Keep open if webContents is being inspected\r\n    if (!this.browserWindow?.isDestroyed() && this.browserWindow?.webContents.isDevToolsOpened()) {\r\n      debug('preventing close due to DevTools being open')\r\n      return\r\n    }\r\n\r\n    // For extension popups with a login form, the user may need to access a\r\n    // program outside of the app. Closing the popup would then add\r\n    // inconvenience.\r\n    if (!BrowserWindow.getFocusedWindow()) {\r\n      debug('preventing close due to focus residing outside of the app')\r\n      return\r\n    }\r\n\r\n    this.destroy()\r\n  }\r\n\r\n  private updatePosition() {\r\n    if (!this.browserWindow || !this.parent) return\r\n\r\n    const winBounds = this.parent.getBounds()\r\n    const viewBounds = this.browserWindow.getBounds()\r\n\r\n    // TODO: support more orientations than just top-right\r\n    let x = winBounds.x + this.anchorRect.x + this.anchorRect.width - viewBounds.width\r\n    let y = winBounds.y + this.anchorRect.y + this.anchorRect.height + PopupView.POSITION_PADDING\r\n\r\n    // Convert to ints\r\n    x = Math.floor(x)\r\n    y = Math.floor(y)\r\n\r\n    debug(`updatePosition`, { x, y })\r\n\r\n    this.browserWindow.setBounds({\r\n      ...this.browserWindow.getBounds(),\r\n      x,\r\n      y,\r\n    })\r\n  }\r\n\r\n  /** Backwards compat for Electron <12 */\r\n  private async queryPreferredSize() {\r\n    if (this.usingPreferredSize || this.destroyed) return\r\n\r\n    const rect = await this.browserWindow!.webContents.executeJavaScript(\r\n      `((${() => {\r\n        const rect = document.body.getBoundingClientRect()\r\n        return { width: rect.width, height: rect.height }\r\n      }})())`\r\n    )\r\n\r\n    if (this.destroyed) return\r\n\r\n    this.setSize({ width: rect.width, height: rect.height })\r\n    this.updatePosition()\r\n  }\r\n\r\n  private updatePreferredSize = (event: Electron.Event, size: Electron.Size) => {\r\n    debug('updatePreferredSize', size)\r\n    this.usingPreferredSize = true\r\n    this.setSize(size)\r\n    this.updatePosition()\r\n  }\r\n}\r\n","import { app, Extension, ipcMain, session, Session, WebContents } from 'electron'\r\n\r\nconst createDebug = require('debug')\r\n\r\n// Shorten base64 encoded icons\r\nconst shortenValues = (k: string, v: any) =>\r\n  typeof v === 'string' && v.length > 128 ? v.substr(0, 128) + '...' : v\r\n\r\ncreateDebug.formatters.r = (value: any) => {\r\n  return value ? JSON.stringify(value, shortenValues, '  ') : value\r\n}\r\n\r\nconst debug = createDebug('electron-chrome-extensions:router')\r\n\r\nconst DEFAULT_SESSION = '_self'\r\n\r\ninterface RoutingDelegateObserver {\r\n  session: Electron.Session\r\n  onExtensionMessage(\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string | undefined,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ): Promise<void>\r\n  addListener(listener: EventListener, extensionId: string, eventName: string): void\r\n  removeListener(listener: EventListener, extensionId: string, eventName: string): void\r\n}\r\n\r\nlet gRoutingDelegate: RoutingDelegate\r\n\r\n/**\r\n * Handles event routing IPCs and delivers them to the observer with the\r\n * associated session.\r\n */\r\nclass RoutingDelegate {\r\n  static get() {\r\n    return gRoutingDelegate || (gRoutingDelegate = new RoutingDelegate())\r\n  }\r\n\r\n  private sessionMap: WeakMap<Session, RoutingDelegateObserver> = new WeakMap()\r\n\r\n  private constructor() {\r\n    ipcMain.handle('crx-msg', this.onRouterMessage)\r\n    ipcMain.handle('crx-msg-remote', this.onRemoteMessage)\r\n    ipcMain.on('crx-add-listener', this.onAddListener)\r\n    ipcMain.on('crx-remove-listener', this.onRemoveListener)\r\n  }\r\n\r\n  addObserver(observer: RoutingDelegateObserver) {\r\n    this.sessionMap.set(observer.session, observer)\r\n  }\r\n\r\n  private onRouterMessage = async (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) => {\r\n    debug(`received '${handlerName}'`, args)\r\n\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n\r\n    return observer?.onExtensionMessage(event, extensionId, handlerName, ...args)\r\n  }\r\n\r\n  private onRemoteMessage = async (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    sessionPartition: string,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) => {\r\n    debug(`received remote '${handlerName}' for '${sessionPartition}'`, args)\r\n\r\n    const ses =\r\n      sessionPartition === DEFAULT_SESSION\r\n        ? event.sender.session\r\n        : session.fromPartition(sessionPartition)\r\n\r\n    const observer = this.sessionMap.get(ses)\r\n\r\n    return observer?.onExtensionMessage(event, undefined, handlerName, ...args)\r\n  }\r\n\r\n  private onAddListener = (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    eventName: string\r\n  ) => {\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n    const listener: EventListener = { host: event.sender, extensionId }\r\n    return observer?.addListener(listener, extensionId, eventName)\r\n  }\r\n\r\n  private onRemoveListener = (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    eventName: string\r\n  ) => {\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n    const listener: EventListener = { host: event.sender, extensionId }\r\n    return observer?.removeListener(listener, extensionId, eventName)\r\n  }\r\n}\r\n\r\nexport interface ExtensionEvent {\r\n  sender: WebContents\r\n  extension: Extension\r\n}\r\n\r\nexport type HandlerCallback = (event: ExtensionEvent, ...args: any[]) => any\r\n\r\nexport interface HandlerOptions {\r\n  /** Whether the handler can be invoked on behalf of a different session. */\r\n  allowRemote?: boolean\r\n  /** Whether an extension context is required to invoke the handler. */\r\n  extensionContext: boolean\r\n}\r\n\r\ninterface Handler extends HandlerOptions {\r\n  callback: HandlerCallback\r\n}\r\n\r\n/** e.g. 'tabs.query' */\r\ntype EventName = string\r\n\r\ntype HandlerMap = Map<EventName, Handler>\r\n\r\ninterface EventListener {\r\n  host: Electron.WebContents\r\n  extensionId: string\r\n}\r\n\r\nconst eventListenerEquals = (eventListener: EventListener) => (other: EventListener) =>\r\n  other.host === eventListener.host && other.extensionId === eventListener.extensionId\r\n\r\nexport class ExtensionRouter {\r\n  private handlers: HandlerMap = new Map()\r\n  private listeners: Map<EventName, EventListener[]> = new Map()\r\n\r\n  /**\r\n   * Collection of all extension hosts in the session.\r\n   *\r\n   * Currently the router has no ability to wake up non-persistent background\r\n   * scripts to deliver events. For now we just hold a reference to them to\r\n   * prevent them from being terminated.\r\n   */\r\n  private extensionHosts: Set<Electron.WebContents> = new Set()\r\n\r\n  constructor(\r\n    public session: Electron.Session,\r\n    private delegate: RoutingDelegate = RoutingDelegate.get()\r\n  ) {\r\n    this.delegate.addObserver(this)\r\n\r\n    session.on('extension-unloaded', (event, extension) => {\r\n      this.filterListeners((listener) => listener.extensionId !== extension.id)\r\n    })\r\n\r\n    app.on('web-contents-created', (event, webContents) => {\r\n      if (webContents.session === this.session && webContents.getType() === 'backgroundPage') {\r\n        debug(`storing reference to background host [url:'${webContents.getURL()}']`)\r\n        this.extensionHosts.add(webContents)\r\n      }\r\n    })\r\n  }\r\n\r\n  private filterListeners(predicate: (listener: EventListener) => boolean) {\r\n    for (const [eventName, listeners] of this.listeners) {\r\n      const filteredListeners = listeners.filter(predicate)\r\n      const delta = listeners.length - filteredListeners.length\r\n\r\n      if (filteredListeners.length > 0) {\r\n        this.listeners.set(eventName, filteredListeners)\r\n      } else {\r\n        this.listeners.delete(eventName)\r\n      }\r\n\r\n      if (delta > 0) {\r\n        debug(`removed ${delta} listener(s) for '${eventName}'`)\r\n      }\r\n    }\r\n  }\r\n\r\n  private observeListenerHost(host: Electron.WebContents) {\r\n    debug(`observing listener [id:${host.id}, url:'${host.getURL()}']`)\r\n    host.once('destroyed', () => {\r\n      debug(`extension host destroyed [id:${host.id}]`)\r\n      this.filterListeners((listener) => listener.host !== host)\r\n    })\r\n  }\r\n\r\n  addListener(listener: EventListener, extensionId: string, eventName: string) {\r\n    const { listeners, session } = this\r\n\r\n    const extension = session.getExtension(extensionId)\r\n    if (!extension) {\r\n      throw new Error(`extension not registered in session [extensionId:${extensionId}]`)\r\n    }\r\n\r\n    if (!listeners.has(eventName)) {\r\n      listeners.set(eventName, [])\r\n    }\r\n\r\n    const eventListeners = listeners.get(eventName)!\r\n    const existingEventListener = eventListeners.find(eventListenerEquals(listener))\r\n\r\n    if (existingEventListener) {\r\n      debug(`ignoring existing '${eventName}' event listener for ${extensionId}`)\r\n    } else {\r\n      debug(`adding '${eventName}' event listener for ${extensionId}`)\r\n      eventListeners.push(listener)\r\n      this.observeListenerHost(listener.host)\r\n    }\r\n  }\r\n\r\n  removeListener(listener: EventListener, extensionId: string, eventName: string) {\r\n    const { listeners } = this\r\n\r\n    const eventListeners = listeners.get(eventName)\r\n    if (!eventListeners) {\r\n      console.error(`event listener not registered for '${eventName}'`)\r\n      return\r\n    }\r\n\r\n    const index = eventListeners.findIndex(eventListenerEquals(listener))\r\n\r\n    if (index >= 0) {\r\n      debug(`removing '${eventName}' event listener for ${extensionId}`)\r\n      eventListeners.splice(index, 1)\r\n    }\r\n\r\n    if (eventListeners.length === 0) {\r\n      listeners.delete(eventName)\r\n    }\r\n  }\r\n\r\n  private getHandler(handlerName: string) {\r\n    const handler = this.handlers.get(handlerName)\r\n    if (!handler) {\r\n      throw new Error(`${handlerName} is not a registered handler`)\r\n    }\r\n\r\n    return handler\r\n  }\r\n\r\n  async onExtensionMessage(\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string | undefined,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) {\r\n    const { session } = this\r\n    const { sender } = event\r\n    const handler = this.getHandler(handlerName)\r\n\r\n    if (sender.session !== session && !handler.allowRemote) {\r\n      throw new Error(`${handlerName} does not support calling from a remote session`)\r\n    }\r\n\r\n    const extension = extensionId ? sender.session.getExtension(extensionId) : undefined\r\n    if (!extension && handler.extensionContext) {\r\n      throw new Error(`${handlerName} was sent from an unknown extension context`)\r\n    }\r\n\r\n    const extEvent = {\r\n      sender,\r\n      extension: extension!,\r\n    }\r\n\r\n    const result = await handler.callback(extEvent, ...args)\r\n\r\n    debug(`${handlerName} result: %r`, result)\r\n\r\n    return result\r\n  }\r\n\r\n  private handle(name: string, callback: HandlerCallback, opts?: HandlerOptions): void {\r\n    this.handlers.set(name, {\r\n      callback,\r\n      extensionContext: typeof opts?.extensionContext === 'boolean' ? opts.extensionContext : true,\r\n      allowRemote: typeof opts?.allowRemote === 'boolean' ? opts.allowRemote : false,\r\n    })\r\n  }\r\n\r\n  /** Returns a callback to register API handlers for the given context. */\r\n  apiHandler() {\r\n    return (name: string, callback: HandlerCallback, opts?: HandlerOptions) => {\r\n      this.handle(name, callback, opts)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sends extension event to the host for the given extension ID if it\r\n   * registered a listener for it.\r\n   */\r\n  sendEvent(extensionId: string | undefined, eventName: string, ...args: any[]) {\r\n    const { listeners } = this\r\n\r\n    let eventListeners = listeners.get(eventName)\r\n\r\n    if (extensionId) {\r\n      // TODO: extension permissions check\r\n\r\n      eventListeners = eventListeners?.filter((el) => el.extensionId === extensionId)\r\n    }\r\n\r\n    if (!eventListeners || eventListeners.length === 0) {\r\n      debug(`ignoring '${eventName}' event with no listeners`)\r\n      return\r\n    }\r\n\r\n    for (const { host } of eventListeners) {\r\n      // TODO: may need to wake lazy extension context\r\n      if (host.isDestroyed()) {\r\n        console.error(`Unable to send '${eventName}' to extension host for ${extensionId}`)\r\n        continue\r\n      }\r\n\r\n      const ipcName = `crx-${eventName}`\r\n      host.send(ipcName, ...args)\r\n    }\r\n  }\r\n\r\n  /** Broadcasts extension event to all extension hosts listening for it. */\r\n  broadcastEvent(eventName: string, ...args: any[]) {\r\n    this.sendEvent(undefined, eventName, ...args)\r\n  }\r\n}\r\n","import { BrowserWindow, webContents } from 'electron'\r\nimport { EventEmitter } from 'events'\r\nimport { ContextMenuType } from './api/common'\r\nimport { ChromeExtensionImpl } from './impl'\r\nimport { ExtensionEvent } from './router'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:store')\r\n\r\nexport class ExtensionStore extends EventEmitter {\r\n  /** Tabs observed by the extensions system. */\r\n  tabs = new Set<Electron.WebContents>()\r\n\r\n  /** Windows observed by the extensions system. */\r\n  windows = new Set<Electron.BrowserWindow>()\r\n\r\n  lastFocusedWindowId?: number\r\n\r\n  /**\r\n   * Map of tabs to their parent window.\r\n   *\r\n   * It's not possible to access the parent of a BrowserView so we must manage\r\n   * this ourselves.\r\n   */\r\n  tabToWindow = new WeakMap<Electron.WebContents, Electron.BrowserWindow>()\r\n\r\n  /** Map of windows to their active tab. */\r\n  private windowToActiveTab = new WeakMap<Electron.BrowserWindow, Electron.WebContents>()\r\n\r\n  tabDetailsCache = new Map<number, Partial<chrome.tabs.Tab>>()\r\n  windowDetailsCache = new Map<number, Partial<chrome.windows.Window>>()\r\n\r\n  constructor(public impl: ChromeExtensionImpl) {\r\n    super()\r\n  }\r\n\r\n  getWindowById(windowId: number) {\r\n    return Array.from(this.windows).find(\r\n      (window) => !window.isDestroyed() && window.id === windowId\r\n    )\r\n  }\r\n\r\n  getLastFocusedWindow() {\r\n    return this.lastFocusedWindowId ? this.getWindowById(this.lastFocusedWindowId) : null\r\n  }\r\n\r\n  getCurrentWindow() {\r\n    return this.getLastFocusedWindow()\r\n  }\r\n\r\n  addWindow(window: Electron.BrowserWindow) {\r\n    if (this.windows.has(window)) return\r\n\r\n    this.windows.add(window)\r\n\r\n    if (typeof this.lastFocusedWindowId !== 'number') {\r\n      this.lastFocusedWindowId = window.id\r\n    }\r\n\r\n    this.emit('window-added', window)\r\n  }\r\n\r\n  async createWindow(event: ExtensionEvent, details: chrome.windows.CreateData) {\r\n    if (typeof this.impl.createWindow !== 'function') {\r\n      throw new Error('createWindow is not implemented')\r\n    }\r\n\r\n    const win = await this.impl.createWindow(details)\r\n\r\n    this.addWindow(win)\r\n\r\n    return win\r\n  }\r\n\r\n  async removeWindow(window: Electron.BrowserWindow) {\r\n    if (!this.windows.has(window)) return\r\n\r\n    this.windows.delete(window)\r\n\r\n    if (typeof this.impl.removeWindow === 'function') {\r\n      await this.impl.removeWindow(window)\r\n    } else {\r\n      window.destroy()\r\n    }\r\n  }\r\n\r\n  getTabById(tabId: number) {\r\n    return Array.from(this.tabs).find((tab) => !tab.isDestroyed() && tab.id === tabId)\r\n  }\r\n\r\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\r\n    if (this.tabs.has(tab)) return\r\n\r\n    this.tabs.add(tab)\r\n    this.tabToWindow.set(tab, window)\r\n    this.addWindow(window)\r\n\r\n    const activeTab = this.getActiveTabFromWebContents(tab)\r\n    if (!activeTab) {\r\n      this.setActiveTab(tab)\r\n    }\r\n\r\n    this.emit('tab-added', tab)\r\n  }\r\n\r\n  removeTab(tab: Electron.WebContents) {\r\n    if (!this.tabs.has(tab)) return\r\n\r\n    const tabId = tab.id\r\n    const win = this.tabToWindow.get(tab)!\r\n\r\n    this.tabs.delete(tab)\r\n    this.tabToWindow.delete(tab)\r\n\r\n    // TODO: clear active tab\r\n\r\n    // Clear window if it has no remaining tabs\r\n    const windowHasTabs = Array.from(this.tabs).find((tab) => this.tabToWindow.get(tab) === win)\r\n    if (!windowHasTabs) {\r\n      this.windows.delete(win)\r\n    }\r\n\r\n    if (typeof this.impl.removeTab === 'function') {\r\n      this.impl.removeTab(tab, win)\r\n    }\r\n\r\n    this.emit('tab-removed', tabId)\r\n  }\r\n\r\n  async createTab(details: chrome.tabs.CreateProperties) {\r\n    if (typeof this.impl.createTab !== 'function') {\r\n      throw new Error('createTab is not implemented')\r\n    }\r\n\r\n    // Fallback to current window\r\n    if (!details.windowId) {\r\n      details.windowId = this.lastFocusedWindowId\r\n    }\r\n\r\n    const result = await this.impl.createTab(details)\r\n\r\n    if (!Array.isArray(result)) {\r\n      throw new Error('createTab must return an array of [tab, window]')\r\n    }\r\n\r\n    const [tab, window] = result\r\n\r\n    if (typeof tab !== 'object' || !webContents.fromId(tab.id)) {\r\n      throw new Error('createTab must return a WebContents')\r\n    } else if (typeof window !== 'object') {\r\n      throw new Error('createTab must return a BrowserWindow')\r\n    }\r\n\r\n    this.addTab(tab, window)\r\n\r\n    return tab\r\n  }\r\n\r\n  getActiveTabFromWindow(win: Electron.BrowserWindow) {\r\n    const activeTab = win && !win.isDestroyed() && this.windowToActiveTab.get(win)\r\n    return (activeTab && !activeTab.isDestroyed() && activeTab) || undefined\r\n  }\r\n\r\n  getActiveTabFromWebContents(wc: Electron.WebContents): Electron.WebContents | undefined {\r\n    const win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc)\r\n    return win ? this.getActiveTabFromWindow(win) : undefined\r\n  }\r\n\r\n  getActiveTabOfCurrentWindow() {\r\n    const win = this.getCurrentWindow()\r\n    return win ? this.getActiveTabFromWindow(win) : undefined\r\n  }\r\n\r\n  setActiveTab(tab: Electron.WebContents) {\r\n    const win = this.tabToWindow.get(tab)\r\n    if (!win) {\r\n      throw new Error('Active tab has no parent window')\r\n    }\r\n\r\n    const prevActiveTab = this.getActiveTabFromWebContents(tab)\r\n\r\n    this.windowToActiveTab.set(win, tab)\r\n\r\n    if (tab.id !== prevActiveTab?.id) {\r\n      this.emit('active-tab-changed', tab, win)\r\n\r\n      if (typeof this.impl.selectTab === 'function') {\r\n        this.impl.selectTab(tab, win)\r\n      }\r\n    }\r\n  }\r\n\r\n  buildMenuItems(extensionId: string, menuType: ContextMenuType): Electron.MenuItem[] {\r\n    // This function is overwritten by ContextMenusAPI\r\n    return []\r\n  }\r\n}\r\n","export * from './browser'\r\n","module.exports = require(\"electron\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"tty\");","module.exports = require(\"util\");"],"sourceRoot":""}